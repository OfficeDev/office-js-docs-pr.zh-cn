---
title: Office 加载项的资源限制和性能优化
description: 了解 Office 加载项平台的资源限制，包括 CPU 和内存。
ms.date: 07/29/2020
localization_priority: Normal
ms.openlocfilehash: 8c64e5a836d6b998ccd7022e71f595bb331bba8c
ms.sourcegitcommit: 9609bd5b4982cdaa2ea7637709a78a45835ffb19
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/28/2020
ms.locfileid: "47293329"
---
# <a name="resource-limits-and-performance-optimization-for-office-add-ins"></a><span data-ttu-id="c1046-103">Office 加载项的资源限制和性能优化</span><span class="sxs-lookup"><span data-stu-id="c1046-103">Resource limits and performance optimization for Office Add-ins</span></span>

<span data-ttu-id="c1046-p101">为了向用户提供最佳体验，请确保 Office 加载项不超过 CPU 内核和内存使用、可靠性以及计算正则表达式的响应时间（对于 Outlook 加载项）方面的特定限制。这些运行时资源使用限制仅适用于在 Windows 和 OS X 的 Office 客户端上运行的加载项，而不适用于移动应用或浏览器上的加载项。</span><span class="sxs-lookup"><span data-stu-id="c1046-p101">To create the best experience for your users, ensure that your Office Add-in performs within specific limits for CPU core and memory usage, reliability, and, for Outlook add-ins, the response time for evaluating regular expressions. These run-time resource usage limits apply to add-ins running in Office clients on Windows and OS X, but not on mobile apps or in a browser.</span></span>

<span data-ttu-id="c1046-106">此外，还可以在加载项设计和实现中优化资源使用，从而优化加载项在台式机和移动设备上的性能。</span><span class="sxs-lookup"><span data-stu-id="c1046-106">You can also optimize the performance of your add-ins on desktop and mobile devices by optimizing the use of resources in your add-in design and implementation.</span></span>

## <a name="resource-usage-limits-for-add-ins"></a><span data-ttu-id="c1046-107">加载项的资源使用限制</span><span class="sxs-lookup"><span data-stu-id="c1046-107">Resource usage limits for add-ins</span></span>

<span data-ttu-id="c1046-108">运行时资源使用率限制适用于所有类型的 Office 外接程序。这些限制有助于确保用户性能并缓解拒绝服务攻击。</span><span class="sxs-lookup"><span data-stu-id="c1046-108">Run-time resource usage limits apply to all types of Office Add-ins. These limits help ensure performance for your users and mitigate denial-of-service attacks.</span></span> <span data-ttu-id="c1046-109">请务必使用一系列可能的数据在目标 Office 应用程序上测试你的 Office 外接程序，并根据以下运行时使用限制测量其性能：</span><span class="sxs-lookup"><span data-stu-id="c1046-109">Be sure to test your Office Add-in on your target Office application by using a range of possible data, and measure its performance against the following run-time usage limits:</span></span>

- <span data-ttu-id="c1046-110">**CPU 内核使用** - 单个 CPU 内核使用阈值为 90%，默认每 5 秒监测三次。</span><span class="sxs-lookup"><span data-stu-id="c1046-110">**CPU core usage** - A single CPU core usage threshold of 90%, observed three times in default 5-second intervals.</span></span>

   <span data-ttu-id="c1046-111">Office 客户端检查 CPU 内核使用率的默认间隔是每5秒一次。</span><span class="sxs-lookup"><span data-stu-id="c1046-111">The default interval for an Office client to check CPU core usage is every 5 seconds.</span></span> <span data-ttu-id="c1046-112">如果 Office 客户端检测到外接程序的 CPU 内核使用率高于阈值，则会显示一条消息，询问用户是否要继续运行外接程序。</span><span class="sxs-lookup"><span data-stu-id="c1046-112">If the Office client detects the CPU core usage of an add-in is above the threshold value, it displays a message asking if the user wants to continue running the add-in.</span></span> <span data-ttu-id="c1046-113">如果用户选择继续，Office 客户端在编辑会话过程中不会再次询问用户。</span><span class="sxs-lookup"><span data-stu-id="c1046-113">If the user chooses to continue, the Office client does not ask the user again during that edit session.</span></span> <span data-ttu-id="c1046-114">如果用户运行占用大量 CPU 的加载项，建议管理员使用“AlertInterval”\*\*\*\* 注册表项增加阈值，以减少此类警告消息的显示。</span><span class="sxs-lookup"><span data-stu-id="c1046-114">Administrators might want to use the **AlertInterval** registry key to raise the threshold to reduce the display of this warning message if users run CPU-intensive add-ins.</span></span>

- <span data-ttu-id="c1046-115">**内存使用** - 默认内存使用阈值，根据设备的可用物理内存动态确定。</span><span class="sxs-lookup"><span data-stu-id="c1046-115">**Memory usage** - A default memory usage threshold that is dynamically determined based on the available physical memory of the device.</span></span>

   <span data-ttu-id="c1046-116">默认情况下，当 Office 客户端检测到设备上的物理内存使用率超过了可用内存的80% 时，客户端开始监视加载项的内存使用情况、内容和任务窗格外接程序的文档级别以及 Outlook 外接程序的邮箱级别。如果默认间隔为5秒，客户端将在文档或邮箱级别上的一组加载项的物理内存使用率超过50% 时警告用户。</span><span class="sxs-lookup"><span data-stu-id="c1046-116">By default, when a Office client detects that physical memory usage on a device exceeds 80% of the available memory, the client starts monitoring the add-in's memory usage, at a document level for content and task pane add-ins, and at a mailbox level for Outlook add-ins. At a default interval of 5 seconds, the client warns the user if physical memory usage for a set of add-ins at the document or mailbox level exceeds 50%.</span></span> <span data-ttu-id="c1046-117">此内存使用率限制使用物理内存而非虚拟内存来确保具有有限 RAM 的设备（如平板电脑）保持良好性能。</span><span class="sxs-lookup"><span data-stu-id="c1046-117">This memory usage limit uses physical rather than virtual memory to ensure performance on devices with limited RAM, such as tablets.</span></span> <span data-ttu-id="c1046-118">管理员可以使用显式限制覆盖此动态设置，方法是使用 **MemoryAlertThreshold** Windows 注册表项作为全局设置，红外通过使用 **AlertInterval** 键作为全局设置来调整警报间隔。</span><span class="sxs-lookup"><span data-stu-id="c1046-118">Administrators can override this dynamic setting with an explicit limit by using the **MemoryAlertThreshold** Windows registry key as a global setting, ir adjust the alert interval by using the **AlertInterval** key as a global setting.</span></span>

- <span data-ttu-id="c1046-119">**故障容忍度** - 外接程序的默认限制为 4 次故障。</span><span class="sxs-lookup"><span data-stu-id="c1046-119">**Crash tolerance** - A default limit of four crashes for an add-in.</span></span>

   <span data-ttu-id="c1046-120">管理员可以通过使用 **RestartManagerRetryLimit** 注册表项来调整故障阈值。</span><span class="sxs-lookup"><span data-stu-id="c1046-120">Administrators can adjust the threshold for crashes by using the **RestartManagerRetryLimit** registry key.</span></span>

- <span data-ttu-id="c1046-121">**应用程序阻塞** - 外接程序持续无响应时间阈值为 5 秒。</span><span class="sxs-lookup"><span data-stu-id="c1046-121">**Application blocking** - Prolonged unresponsiveness threshold of 5 seconds for an add-in.</span></span>

   <span data-ttu-id="c1046-122">这会影响用户对加载项和 Office 应用程序的体验。</span><span class="sxs-lookup"><span data-stu-id="c1046-122">This affects the user's experiences of the add-in and the Office application.</span></span> <span data-ttu-id="c1046-123">发生这种情况时，Office 应用程序会自动重新启动适用) 的文档或邮箱的所有活动外接程序 (，并向用户发出警告，指出哪个外接程序变得不响应。</span><span class="sxs-lookup"><span data-stu-id="c1046-123">When this occurs, the Office application automatically restarts all the active add-ins for a document or mailbox (where applicable), and warns the user as to which add-in became unresponsive.</span></span> <span data-ttu-id="c1046-124">外接程序在执行长时间运行的任务但未定期生成处理时，可能达到该阈值。</span><span class="sxs-lookup"><span data-stu-id="c1046-124">Add-ins can reach this threshold when they do not regularly yield processing while performing long-running tasks.</span></span> <span data-ttu-id="c1046-125">有技术可避免出现该阻塞。</span><span class="sxs-lookup"><span data-stu-id="c1046-125">There are techniques to ensure that blocking does not occur.</span></span> <span data-ttu-id="c1046-126">管理员无法替换此阈值。</span><span class="sxs-lookup"><span data-stu-id="c1046-126">Administrators cannot override this threshold.</span></span>

### <a name="outlook-add-ins"></a><span data-ttu-id="c1046-127">Outlook 外接程序</span><span class="sxs-lookup"><span data-stu-id="c1046-127">Outlook add-ins</span></span>

<span data-ttu-id="c1046-p106">如果任何 Outlook 外接程序超过上述 CPU 内核或内存使用率阈值，或者故障容忍度限制，则 Outlook 会禁用该外接程序。Exchange 管理中心会显示应用程序的禁用状态。</span><span class="sxs-lookup"><span data-stu-id="c1046-p106">If any Outlook add-in exceeds the preceding thresholds for CPU core or memory usage, or tolerance limit for crashes, Outlook disables the add-in. The Exchange Admin Center displays the disabled status of the app.</span></span>

> [!NOTE]
> <span data-ttu-id="c1046-130">尽管只有 Outlook 丰富客户端（而不是 Outlook 网页版或移动设备）监视资源使用，如果丰富客户端禁用 Outlook 加载项，加载项也禁用于Outlook 网页版和移动设备。</span><span class="sxs-lookup"><span data-stu-id="c1046-130">Even though only the Outlook rich clients and not Outlook on the web or mobile devices monitor resource usage, if a rich client disables an Outlook add-in, that add-in is also disabled for use in Outlook on the web and mobile devices.</span></span>

<span data-ttu-id="c1046-131">除了 CPU 内核、内存和可靠性规则之外，Outlook 加载项还应在激活后遵循以下规则：</span><span class="sxs-lookup"><span data-stu-id="c1046-131">In addition to the CPU core, memory, and reliability rules, Outlook add-ins should observe the following rules on activation:</span></span>

- <span data-ttu-id="c1046-p107">**正则表达式响应时间** - Outlook 计算 Outlook 外接程序清单中的所有正则表达式的默认阈值为 1,000 毫秒。超过该阈值会导致 Outlook 稍后重新尝试计算。</span><span class="sxs-lookup"><span data-stu-id="c1046-p107">**Regular expressions response time** - A default threshold of 1,000 milliseconds for Outlook to evaluate all regular expressions in the manifest of an Outlook add-in. Exceeding the threshold causes Outlook to retry evaluation at a later time.</span></span>

    <span data-ttu-id="c1046-134">通过使用组策略或 Windows 注册表中特定于应用程序的设置，管理员可以在 **OutlookActivationAlertThreshold** 设置中调整此 1,000 毫秒的默认阈值。</span><span class="sxs-lookup"><span data-stu-id="c1046-134">Using a group policy or application-specific setting in the Windows registry, administrators can adjust this default threshold value of 1,000 milliseconds in the **OutlookActivationAlertThreshold** setting.</span></span>

- <span data-ttu-id="c1046-135">**正则表达式重新计算** - Outlook 重新计算清单中的所有正则表达式的默认限制为三次。</span><span class="sxs-lookup"><span data-stu-id="c1046-135">**Regular expressions re-evaluation** - A default limit of three times for Outlook to reevaluate all the regular expressions in a manifest.</span></span> <span data-ttu-id="c1046-136">如果评估因超出适用阈值而失败 (三次（默认值为1000毫秒或由 **OutlookActivationAlertThreshold**指定的值），如果 Windows 注册表) 中存在该设置，则 outlook 将禁用 outlook 外接程序。</span><span class="sxs-lookup"><span data-stu-id="c1046-136">If evaluation fails all three times by exceeding the applicable threshold (which is either the default of 1,000 milliseconds or a value specified by **OutlookActivationAlertThreshold**, if that setting exists in the Windows registry), Outlook disables the Outlook add-in.</span></span> <span data-ttu-id="c1046-137">Exchange 管理中心显示已禁用的状态，并且外接程序在 Outlook 富客户端中被禁用，而在 web 和移动设备上使用的是 Outlook。</span><span class="sxs-lookup"><span data-stu-id="c1046-137">The Exchange Admin Center displays the disabled status, and the add-in is disabled for use in the Outlook rich clients, and Outlook on the web and mobile devices.</span></span>

    <span data-ttu-id="c1046-138">通过使用组策略或 Windows 注册表中特定于应用程序的设置，管理员可以在 **OutlookActivationManagerRetryLimit** 设置中调整此重试计算的次数。</span><span class="sxs-lookup"><span data-stu-id="c1046-138">Using a group policy or application-specific setting in the Windows registry, administrators can adjust this number of times to retry evaluation in the **OutlookActivationManagerRetryLimit** setting.</span></span>

### <a name="excel-add-ins"></a><span data-ttu-id="c1046-139">Excel 加载项</span><span class="sxs-lookup"><span data-stu-id="c1046-139">Excel add-ins</span></span>

<span data-ttu-id="c1046-140">如果您正在构建 Excel 外接程序，请注意与工作簿交互时的以下大小限制：</span><span class="sxs-lookup"><span data-stu-id="c1046-140">If you're building an Excel add-in, be aware of the following size limitations when interacting with the workbook:</span></span>

- <span data-ttu-id="c1046-141">Excel 网页版将请求和响应的有效负载大小限制为 5MB。</span><span class="sxs-lookup"><span data-stu-id="c1046-141">Excel on the web has a payload size limit for requests and responses of 5MB.</span></span> <span data-ttu-id="c1046-142">如果超过该限制，将引发 `RichAPI.Error`。</span><span class="sxs-lookup"><span data-stu-id="c1046-142">`RichAPI.Error` will be thrown if that limit is exceeded.</span></span>
- <span data-ttu-id="c1046-143">对于 get 操作，范围限制为5000000个单元格。</span><span class="sxs-lookup"><span data-stu-id="c1046-143">A range is limited to five million cells for get operations.</span></span>

<span data-ttu-id="c1046-144">如果您希望用户输入超出这些限制，请务必先检查数据，然后再调用 `context.sync()` 。</span><span class="sxs-lookup"><span data-stu-id="c1046-144">If you expect user input to exceed these limits, be sure to check the data before calling `context.sync()`.</span></span> <span data-ttu-id="c1046-145">根据需要将操作拆分为较小的部分。</span><span class="sxs-lookup"><span data-stu-id="c1046-145">Split the operation into smaller pieces as needed.</span></span> <span data-ttu-id="c1046-146">请务必 `context.sync()` 为每个子操作调用，以避免这些操作再次成批组合。</span><span class="sxs-lookup"><span data-stu-id="c1046-146">Be sure to call `context.sync()` for each sub-operation to avoid those operations getting batched together again.</span></span>

<span data-ttu-id="c1046-147">这些限制通常由大型区域所超过。</span><span class="sxs-lookup"><span data-stu-id="c1046-147">These limitations are typically exceeded by large ranges.</span></span> <span data-ttu-id="c1046-148">您的外接程序可能能够使用 [RangeAreas](/javascript/api/excel/excel.rangeareas) 对较大范围内的单元格进行战略更新。</span><span class="sxs-lookup"><span data-stu-id="c1046-148">Your add-in might be able to use [RangeAreas](/javascript/api/excel/excel.rangeareas) to strategically update cells within a larger range.</span></span> <span data-ttu-id="c1046-149">有关详细信息，请参阅 [在 Excel 外接程序中同时处理多个区域](../excel/excel-add-ins-multiple-ranges.md) 。</span><span class="sxs-lookup"><span data-stu-id="c1046-149">See [Work with multiple ranges simultaneously in Excel add-ins](../excel/excel-add-ins-multiple-ranges.md) for more information.</span></span>

### <a name="task-pane-and-content-add-ins"></a><span data-ttu-id="c1046-150">任务窗格和内容外接程序</span><span class="sxs-lookup"><span data-stu-id="c1046-150">Task pane and content add-ins</span></span>

<span data-ttu-id="c1046-151">如果任何内容或任务窗格外接程序的 CPU 内核或内存使用率超过前面的阈值，或者崩溃的容限限制，相应的 Office 应用程序将为用户显示警告。</span><span class="sxs-lookup"><span data-stu-id="c1046-151">If any content or task pane add-in exceeds the preceding thresholds on CPU core or memory usage, or tolerance limit for crashes, the corresponding Office application displays a warning for the user.</span></span> <span data-ttu-id="c1046-152">此时，用户可以执行下列操作之一：</span><span class="sxs-lookup"><span data-stu-id="c1046-152">At this point, the user can do one of the following:</span></span>

- <span data-ttu-id="c1046-153">重新启动外接程序。</span><span class="sxs-lookup"><span data-stu-id="c1046-153">Restart the add-in.</span></span>
- <span data-ttu-id="c1046-p113">取消有关超出该阈值的后续警报。理想的情况是，用户应当从文档中删除该外接程序；继续使用该外接程序可能会遇到更多性能和稳定性问题。</span><span class="sxs-lookup"><span data-stu-id="c1046-p113">Cancel further alerts about exceeding that threshold. Ideally, the user should then delete the add-in from the document; continuing the add-in would risk further performance and stability issues.</span></span>  

## <a name="verifying-resource-usage-issues-in-the-telemetry-log"></a><span data-ttu-id="c1046-156">验证遥测日志中的资源使用率问题</span><span class="sxs-lookup"><span data-stu-id="c1046-156">Verifying resource usage issues in the Telemetry Log</span></span>

<span data-ttu-id="c1046-p114">Office 提供了遥测日志，以保留本地计算机上运行的 Office 解决方案的某些事件（加载、打开、关闭和错误）的记录，包括 Office 外接程序中的资源使用率问题。如果您已设置遥测日志，则可以使用 Excel 在您的本地驱动器中的以下默认位置打开遥测日志：</span><span class="sxs-lookup"><span data-stu-id="c1046-p114">Office provides a Telemetry Log that maintains a record of certain events (loading, opening, closing, and errors) of Office solutions running on the local computer, including resource usage issues in an Office Add-in. If you have the Telemetry Log set up, you can use Excel to open the Telemetry Log in the following default location on your local drive:</span></span>

`%Users%\<Current user>\AppData\Local\Microsoft\Office\15.0\Telemetry`

<span data-ttu-id="c1046-p115">对于遥测日志跟踪的外接程序的每个事件，都有事件的发生日期/时间、事件 ID、严重性、事件的简短描述性标题、外接程序的友好名称和唯一 ID，以及记录事件的应用程序。可刷新遥测日志以查看当前跟踪的事件。下表显示了之前在遥测日志中跟踪的 Outlook 外接程序的示例。</span><span class="sxs-lookup"><span data-stu-id="c1046-p115">For each event that the Telemetry Log tracks for an add-in, there is a date/time of the occurrence, event ID, severity, and short descriptive title for the event, the friendly name and unique ID of the add-in, and the application that logged the event. You can refresh the Telemetry Log to see the current tracked events. The following table shows examples of Outlook add-ins that were tracked in the Telemetry log.</span></span>

|<span data-ttu-id="c1046-162">**日期/时间**</span><span class="sxs-lookup"><span data-stu-id="c1046-162">**Date/Time**</span></span>|<span data-ttu-id="c1046-163">**事件 ID**</span><span class="sxs-lookup"><span data-stu-id="c1046-163">**Event ID**</span></span>|<span data-ttu-id="c1046-164">**严重性**</span><span class="sxs-lookup"><span data-stu-id="c1046-164">**Severity**</span></span>|<span data-ttu-id="c1046-165">**标题**</span><span class="sxs-lookup"><span data-stu-id="c1046-165">**Title**</span></span>|<span data-ttu-id="c1046-166">**文件**</span><span class="sxs-lookup"><span data-stu-id="c1046-166">**File**</span></span>|<span data-ttu-id="c1046-167">**ID**</span><span class="sxs-lookup"><span data-stu-id="c1046-167">**ID**</span></span>|<span data-ttu-id="c1046-168">**应用程序**</span><span class="sxs-lookup"><span data-stu-id="c1046-168">**Application**</span></span>|
|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="c1046-169">10/8/2012 5:57:10 PM</span><span class="sxs-lookup"><span data-stu-id="c1046-169">10/8/2012 5:57:10 PM</span></span>|<span data-ttu-id="c1046-170">7 </span><span class="sxs-lookup"><span data-stu-id="c1046-170">7</span></span>||<span data-ttu-id="c1046-171">外接程序清单已成功下载</span><span class="sxs-lookup"><span data-stu-id="c1046-171">add-in manifest downloaded successfully</span></span>|<span data-ttu-id="c1046-172">Who's Who</span><span class="sxs-lookup"><span data-stu-id="c1046-172">Who's Who</span></span>|<span data-ttu-id="c1046-173">69cc567c-6737-4c49-88dd-123334943a22</span><span class="sxs-lookup"><span data-stu-id="c1046-173">69cc567c-6737-4c49-88dd-123334943a22</span></span>|<span data-ttu-id="c1046-174">Outlook</span><span class="sxs-lookup"><span data-stu-id="c1046-174">Outlook</span></span>|
|<span data-ttu-id="c1046-175">10/8/2012 5:57:01 PM</span><span class="sxs-lookup"><span data-stu-id="c1046-175">10/8/2012 5:57:01 PM</span></span>|<span data-ttu-id="c1046-176">7 </span><span class="sxs-lookup"><span data-stu-id="c1046-176">7</span></span>||<span data-ttu-id="c1046-177">外接程序清单已成功下载</span><span class="sxs-lookup"><span data-stu-id="c1046-177">add-in manifest downloaded successfully</span></span>|<span data-ttu-id="c1046-178">LinkedIn</span><span class="sxs-lookup"><span data-stu-id="c1046-178">LinkedIn</span></span>|<span data-ttu-id="c1046-179">333bf46d-7dad-4f2b-8cf4-c19ddc78b723</span><span class="sxs-lookup"><span data-stu-id="c1046-179">333bf46d-7dad-4f2b-8cf4-c19ddc78b723</span></span>|<span data-ttu-id="c1046-180">Outlook</span><span class="sxs-lookup"><span data-stu-id="c1046-180">Outlook</span></span>|

<span data-ttu-id="c1046-181">下表列出了遥测日志通常跟踪的 Office 外接程序的事件。</span><span class="sxs-lookup"><span data-stu-id="c1046-181">The following table lists the events that the Telemetry Log tracks for Office Add-ins in general.</span></span>

|<span data-ttu-id="c1046-182">**事件 ID**</span><span class="sxs-lookup"><span data-stu-id="c1046-182">**Event ID**</span></span>|<span data-ttu-id="c1046-183">**标题**</span><span class="sxs-lookup"><span data-stu-id="c1046-183">**Title**</span></span>|<span data-ttu-id="c1046-184">**严重性**</span><span class="sxs-lookup"><span data-stu-id="c1046-184">**Severity**</span></span>|<span data-ttu-id="c1046-185">**说明**</span><span class="sxs-lookup"><span data-stu-id="c1046-185">**Description**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="c1046-186">7 </span><span class="sxs-lookup"><span data-stu-id="c1046-186">7</span></span>|<span data-ttu-id="c1046-187">外接程序清单已成功下载</span><span class="sxs-lookup"><span data-stu-id="c1046-187">Add-in manifest downloaded successfully</span></span>||<span data-ttu-id="c1046-188">Office 加载项的清单已成功加载并由 Office 应用程序读取。</span><span class="sxs-lookup"><span data-stu-id="c1046-188">The manifest of the Office Add-in was successfully loaded and read by the Office application.</span></span>|
|<span data-ttu-id="c1046-189">8 </span><span class="sxs-lookup"><span data-stu-id="c1046-189">8</span></span>|<span data-ttu-id="c1046-190">外接程序清单未下载</span><span class="sxs-lookup"><span data-stu-id="c1046-190">Add-in manifest did not download</span></span>|<span data-ttu-id="c1046-191">关键</span><span class="sxs-lookup"><span data-stu-id="c1046-191">Critical</span></span>|<span data-ttu-id="c1046-192">Office 应用程序无法从 SharePoint 目录、企业目录或 AppSource 加载 Office 外接程序的清单文件。</span><span class="sxs-lookup"><span data-stu-id="c1046-192">The Office application was unable to load the manifest file for the Office Add-in from the SharePoint catalog, corporate catalog, or AppSource.</span></span>|
|<span data-ttu-id="c1046-193">9 </span><span class="sxs-lookup"><span data-stu-id="c1046-193">9</span></span>|<span data-ttu-id="c1046-194">无法分析外接程序标记</span><span class="sxs-lookup"><span data-stu-id="c1046-194">Add-in markup could not be parsed</span></span>|<span data-ttu-id="c1046-195">关键</span><span class="sxs-lookup"><span data-stu-id="c1046-195">Critical</span></span>|<span data-ttu-id="c1046-196">Office 应用程序已加载 Office 外接程序清单，但无法读取应用程序的 HTML 标记。</span><span class="sxs-lookup"><span data-stu-id="c1046-196">The Office application loaded the Office Add-in manifest, but could not read the HTML markup of the app.</span></span>|
|<span data-ttu-id="c1046-197">10 </span><span class="sxs-lookup"><span data-stu-id="c1046-197">10</span></span>|<span data-ttu-id="c1046-198">外接程序占用了太多 CPU</span><span class="sxs-lookup"><span data-stu-id="c1046-198">Add-in used too much CPU</span></span>|<span data-ttu-id="c1046-199">关键</span><span class="sxs-lookup"><span data-stu-id="c1046-199">Critical</span></span>|<span data-ttu-id="c1046-200">在有限的时间内，Office 外接程序使用了超过 90% 的 CPU 资源。</span><span class="sxs-lookup"><span data-stu-id="c1046-200">The Office Add-in used more than 90% of the CPU resources over a finite period of time.</span></span>|
|<span data-ttu-id="c1046-201">15 </span><span class="sxs-lookup"><span data-stu-id="c1046-201">15</span></span>|<span data-ttu-id="c1046-202">由于字符串搜索超时，外接程序已被禁用</span><span class="sxs-lookup"><span data-stu-id="c1046-202">Add-in disabled due to string search time-out</span></span>||<span data-ttu-id="c1046-p116">Outlook 外接程序搜索电子邮件的主题行和消息，以确定是否应使用正则表达式来显示它们。“文件”\*\*\*\* 列中列出的 Outlook 外接程序已被 Outlook 禁用，因为它在尝试匹配正则表达式时超时多次。</span><span class="sxs-lookup"><span data-stu-id="c1046-p116">Outlook add-ins search the subject line and message of an e-mail to determine whether they should be displayed by using a regular expression. The Outlook add-in listed in the **File** column was disabled by Outlook because it timed out repeatedly while trying to match a regular expression.</span></span>|
|<span data-ttu-id="c1046-205">18 </span><span class="sxs-lookup"><span data-stu-id="c1046-205">18</span></span>|<span data-ttu-id="c1046-206">外接程序已成功关闭</span><span class="sxs-lookup"><span data-stu-id="c1046-206">Add-in closed successfully</span></span>||<span data-ttu-id="c1046-207">Office 应用程序能够成功关闭 Office 外接程序。</span><span class="sxs-lookup"><span data-stu-id="c1046-207">The Office application was able to close the Office Add-in successfully.</span></span>|
|<span data-ttu-id="c1046-208">合</span><span class="sxs-lookup"><span data-stu-id="c1046-208">19</span></span>|<span data-ttu-id="c1046-209">外接程序遇到运行时错误</span><span class="sxs-lookup"><span data-stu-id="c1046-209">Add-in encountered runtime error</span></span>|<span data-ttu-id="c1046-210">关键</span><span class="sxs-lookup"><span data-stu-id="c1046-210">Critical</span></span>|<span data-ttu-id="c1046-211">Office 外接程序遇到一个导致它失败的问题。</span><span class="sxs-lookup"><span data-stu-id="c1046-211">The Office Add-in had a problem that caused it to fail.</span></span> <span data-ttu-id="c1046-212">有关详细信息，请使用遇到错误的计算机上的 Windows 事件查看器查看“Microsoft Office 通知”\*\*\*\* 日志。</span><span class="sxs-lookup"><span data-stu-id="c1046-212">For more details, look at the **Microsoft Office Alerts** log using the Windows Event Viewer on the computer that encountered the error.</span></span>|
|<span data-ttu-id="c1046-213">20</span><span class="sxs-lookup"><span data-stu-id="c1046-213">20</span></span>|<span data-ttu-id="c1046-214">外接程序未能验证许可</span><span class="sxs-lookup"><span data-stu-id="c1046-214">Add-in failed to verify licensing</span></span>|<span data-ttu-id="c1046-215">关键</span><span class="sxs-lookup"><span data-stu-id="c1046-215">Critical</span></span>|<span data-ttu-id="c1046-216">无法验证 Office 外接程序的许可信息，且其可能已过期。</span><span class="sxs-lookup"><span data-stu-id="c1046-216">The licensing information for the Office Add-in could not be verified and may have expired.</span></span> <span data-ttu-id="c1046-217">有关详细信息，请使用遇到错误的计算机上的 Windows 事件查看器查看“Microsoft Office 通知”\*\*\*\* 日志。</span><span class="sxs-lookup"><span data-stu-id="c1046-217">For more details, look at the **Microsoft Office Alerts** log using the Windows Event Viewer on the computer that encountered the error.</span></span>|

<span data-ttu-id="c1046-218">有关详细信息，请参阅[部署遥测仪表板](/previous-versions/office/office-2013-resource-kit/jj219431(v=office.15))和[使用遥测日志排查 Office 文件和自定义解决方案](/office/client-developer/shared/troubleshooting-office-files-and-custom-solutions-with-the-telemetry-log)。</span><span class="sxs-lookup"><span data-stu-id="c1046-218">For more information, see [Deploying Telemetry Dashboard](/previous-versions/office/office-2013-resource-kit/jj219431(v=office.15)) and [Troubleshooting Office files and custom solutions with the telemetry log](/office/client-developer/shared/troubleshooting-office-files-and-custom-solutions-with-the-telemetry-log).</span></span>

## <a name="design-and-implementation-techniques"></a><span data-ttu-id="c1046-219">设计和实现技术</span><span class="sxs-lookup"><span data-stu-id="c1046-219">Design and implementation techniques</span></span>

<span data-ttu-id="c1046-220">尽管 CPU 和内存使用率的资源限制、故障容忍度以及 UI 无响应仅适用于在富客户端上运行的 Office 外接程序，但如果您希望外接程序在所有支持性客户端和设备上的性能都令人满意，优化这些资源和电池的使用情况仍然是头等大事。</span><span class="sxs-lookup"><span data-stu-id="c1046-220">While the resources limits on CPU and memory usage, crash tolerance, UI responsiveness apply to Office Add-ins running only on the rich clients, optimizing the usage of these resources and battery should be a priority if you want your add-in to perform satisfactorily on all supporting clients and devices.</span></span> <span data-ttu-id="c1046-221">如果您的外接程序要执行长时间运行的操作或处理大型数据集，则优化尤为重要。</span><span class="sxs-lookup"><span data-stu-id="c1046-221">Optimization is particularly important if your add-in carries out long-running operations or handles large data sets.</span></span> <span data-ttu-id="c1046-222">下面的列表建议使用一些技术将 CPU 密集型或数据密集型操作分解为较小的块，以便您的外接程序可以避免过多的资源消耗，并且 Office 应用程序可以保持响应能力：</span><span class="sxs-lookup"><span data-stu-id="c1046-222">The following list suggests some techniques to break up CPU-intensive or data-intensive operations into smaller chunks so that your add-in can avoid excessive resource consumption and the Office application can remain responsive:</span></span>

- <span data-ttu-id="c1046-223">在外接程序需要从无限制的数据集中读取大量数据的情况下，您可以在从表格中读取数据时应用分页，或者减小每次短暂读取操作中的数据大小，而不是试图在一次操作中完成全部读取。</span><span class="sxs-lookup"><span data-stu-id="c1046-223">In a scenario where your add-in needs to read a large volume of data from an unbounded dataset, you can apply paging when reading the data from a table, or reduce the size of data in each shorter read operation, rather than attempting to complete the read in one single operation.</span></span> <span data-ttu-id="c1046-224">您可以通过全局对象的 [setTimeout](https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout) 方法执行此操作，以限制输入和输出的持续时间。</span><span class="sxs-lookup"><span data-stu-id="c1046-224">You can do this through the [setTimeout](https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout) method of the global object to limit the duration of input and output.</span></span> <span data-ttu-id="c1046-225">它还会处理定义区块中的数据，来代替随机无限数据。</span><span class="sxs-lookup"><span data-stu-id="c1046-225">It also handles the data in defined chunks instead of randomly unbounded data.</span></span> <span data-ttu-id="c1046-226">另一种方法是使用 [async](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function) 处理承诺。</span><span class="sxs-lookup"><span data-stu-id="c1046-226">Another option is to use [async](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function) to handle your Promises.</span></span>

- <span data-ttu-id="c1046-p121">如果外接程序使用大量占用 CPU 的算法来处理大量数据，则您可以使用 Web Worker 在后台执行长时间运行的任务，同时在前台运行单独的脚本，例如在用户界面中显示进度。Web Worker 不会阻止用户活动并允许 HTML 页面保持响应能力。有关 Web Worker 的示例，请参阅 [Web Worker 的基本信息](https://www.html5rocks.com/tutorials/workers/basics/)。有关 Web Worker API 的详细信息，请参阅 [Web Worker](https://developer.mozilla.org/docs/Web/API/Web_Workers_API)。</span><span class="sxs-lookup"><span data-stu-id="c1046-p121">If your add-in uses a CPU-intensive algorithm to process a large volume of data, you can use web workers to perform the long-running task in the background while running a separate script in the foreground, such as displaying progress in the user interface. Web workers do not block user activities and allow the HTML page to remain responsive. For an example of web workers, see [The Basics of Web Workers](https://www.html5rocks.com/tutorials/workers/basics/). See [Web Workers](https://developer.mozilla.org/docs/Web/API/Web_Workers_API) for more information about the Web Workers API.</span></span>

- <span data-ttu-id="c1046-231">如果外接程序使用大量占用 CPU 的算法，但您可以将数据输入或输出划分成较小的集合，则可以考虑创建一个 Web 服务，将数据传递给该 Web 服务以减轻 CPU 负担，然后等待异步回调。</span><span class="sxs-lookup"><span data-stu-id="c1046-231">If your add-in uses a CPU-intensive algorithm but you can divide the data input or output into smaller sets, consider creating a web service, passing the data to the web service to off-load the CPU, and wait for an asynchronous callback.</span></span>

- <span data-ttu-id="c1046-232">针对预期的最大数据量测试加载项，并限制加载项处理的数据量不得超过此限制。</span><span class="sxs-lookup"><span data-stu-id="c1046-232">Test your add-in against the highest volume of data you expect, and restrict your add-in to process up to that limit.</span></span>

### <a name="performance-improvements-with-the-application-specific-apis"></a><span data-ttu-id="c1046-233">特定于应用程序的 Api 的性能改进</span><span class="sxs-lookup"><span data-stu-id="c1046-233">Performance improvements with the application-specific APIs</span></span>

<span data-ttu-id="c1046-234">[使用特定于应用程序的 api 模型](../develop/application-specific-api-model.md)的性能提示在使用适用于 Excel、OneNote、Visio 和 Word 的应用程序特定的 api 时提供指导。</span><span class="sxs-lookup"><span data-stu-id="c1046-234">The performance tips in [Using the application-specific API model](../develop/application-specific-api-model.md) provide guidance when using the application-specific APIs for Excel, OneNote, Visio, and Word.</span></span> <span data-ttu-id="c1046-235">在摘要中，应执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="c1046-235">In summary, you should:</span></span>

- <span data-ttu-id="c1046-236">[仅加载所需的属性](../develop/application-specific-api-model.md#calling-load-without-parameters-not-recommended)。</span><span class="sxs-lookup"><span data-stu-id="c1046-236">[Only load necessary properties](../develop/application-specific-api-model.md#calling-load-without-parameters-not-recommended).</span></span>
- <span data-ttu-id="c1046-237">[最大限度地减少 # A1 调用 ( 的同步数](../develop/application-specific-api-model.md#performance-tip-minimize-the-number-of-sync-calls)。</span><span class="sxs-lookup"><span data-stu-id="c1046-237">[Minimize the number of sync() calls](../develop/application-specific-api-model.md#performance-tip-minimize-the-number-of-sync-calls).</span></span> <span data-ttu-id="c1046-238">阅读 [避免在循环中使用 context 方法](correlated-objects-pattern.md) ，以获取有关如何在代码中管理调用的详细信息 `sync` 。</span><span class="sxs-lookup"><span data-stu-id="c1046-238">Read [Avoid using the context.sync method in loops](correlated-objects-pattern.md) for further information on how to manage `sync` calls in your code.</span></span>
- <span data-ttu-id="c1046-239">[最大限度地减少所创建的代理对象的数量](../develop/application-specific-api-model.md#performance-tip-minimize-the-number-of-proxy-objects-created)。</span><span class="sxs-lookup"><span data-stu-id="c1046-239">[Minimize the number of proxy objects created](../develop/application-specific-api-model.md#performance-tip-minimize-the-number-of-proxy-objects-created).</span></span> <span data-ttu-id="c1046-240">您还可以 untrack 代理对象，如下一节中所述。</span><span class="sxs-lookup"><span data-stu-id="c1046-240">You can also untrack proxy objects, as described in the next section.</span></span>

#### <a name="untrack-unneeded-proxy-objects"></a><span data-ttu-id="c1046-241">Untrack 不需要的代理对象</span><span class="sxs-lookup"><span data-stu-id="c1046-241">Untrack unneeded proxy objects</span></span>

<span data-ttu-id="c1046-242">在调用之前，[代理对象](../develop/application-specific-api-model.md#proxy-objects)将一直保留在内存中 `RequestContext.sync()` 。</span><span class="sxs-lookup"><span data-stu-id="c1046-242">[Proxy objects](../develop/application-specific-api-model.md#proxy-objects) persist in memory until `RequestContext.sync()` is called.</span></span> <span data-ttu-id="c1046-243">大型批处理操作可能会生成许多代理对象，加载项只需用到这些对象一次，并且可以在批处理执行之前从内存中释放。</span><span class="sxs-lookup"><span data-stu-id="c1046-243">Large batch operations may generate a lot of proxy objects that are only needed once by the add-in and can be released from memory before the batch executes.</span></span>

<span data-ttu-id="c1046-244">该 `untrack()` 方法从内存中释放对象。</span><span class="sxs-lookup"><span data-stu-id="c1046-244">The `untrack()` method releases the object from memory.</span></span> <span data-ttu-id="c1046-245">此方法在许多特定于应用程序的 API 代理对象上实现。</span><span class="sxs-lookup"><span data-stu-id="c1046-245">This method is implemented on many application-specific API proxy objects.</span></span> <span data-ttu-id="c1046-246">在 `untrack()` 外接程序完成后调用对象应在使用大量代理对象时产生显著的性能优势。</span><span class="sxs-lookup"><span data-stu-id="c1046-246">Calling `untrack()` after your add-in is done with the object should yield a noticeable performance benefit when using large numbers of proxy objects.</span></span>

> [!NOTE]
> <span data-ttu-id="c1046-247">`Range.untrack()` 是 [ClientRequestContext.trackedObjects.remove(thisRange)](/javascript/api/office/officeextension.trackedobjects#remove-object-) 的快捷方式。</span><span class="sxs-lookup"><span data-stu-id="c1046-247">`Range.untrack()` is a shortcut for [ClientRequestContext.trackedObjects.remove(thisRange)](/javascript/api/office/officeextension.trackedobjects#remove-object-).</span></span> <span data-ttu-id="c1046-248">任何代理对象都可以通过从上下文中的跟踪对象列表中删除它来取消跟踪。</span><span class="sxs-lookup"><span data-stu-id="c1046-248">Any proxy object can be untracked by removing it from the tracked objects list in the context.</span></span>

<span data-ttu-id="c1046-249">下面的 Excel 代码示例使用数据填充选定范围，每次填充一个单元格。</span><span class="sxs-lookup"><span data-stu-id="c1046-249">The following Excel code sample fills a selected range with data, one cell at a time.</span></span> <span data-ttu-id="c1046-250">将值添加到单元格后，表示该单元格的区域将被取消跟踪。</span><span class="sxs-lookup"><span data-stu-id="c1046-250">After the value is added to the cell, the range representing that cell is untracked.</span></span> <span data-ttu-id="c1046-251">在选定的 10,000 到 20,000 个单元格区域运行此代码，首先使用 `cell.untrack()` 行，然后取消使用。</span><span class="sxs-lookup"><span data-stu-id="c1046-251">Run this code with a selected range of 10,000 to 20,000 cells, first with the `cell.untrack()` line, and then without it.</span></span> <span data-ttu-id="c1046-252">应会注意到，使用 `cell.untrack()` 行的代码比不使用的代码运行速度要快。</span><span class="sxs-lookup"><span data-stu-id="c1046-252">You should notice the code runs faster with the `cell.untrack()` line than without it.</span></span> <span data-ttu-id="c1046-253">此外，可能还会注意到之后的响应时间更快，因为清理步骤花费的时间更少。</span><span class="sxs-lookup"><span data-stu-id="c1046-253">You may also notice a quicker response time afterwards, since the cleanup step takes less time.</span></span>

```js
Excel.run(async (context) => {
    var largeRange = context.workbook.getSelectedRange();
    largeRange.load(["rowCount", "columnCount"]);
    await context.sync();

    for (var i = 0; i < largeRange.rowCount; i++) {
        for (var j = 0; j < largeRange.columnCount; j++) {
            var cell = largeRange.getCell(i, j);
            cell.values = [[i *j]];

            // Call untrack() to release the range from memory.
            cell.untrack();
        }
    }

    await context.sync();
});
```

<span data-ttu-id="c1046-254">请注意，只有在处理数以千计的对象时，才需要 untrack 对象才会变得非常重要。</span><span class="sxs-lookup"><span data-stu-id="c1046-254">Note that needing to untrack objects only becomes important when you're dealing with thousands of them.</span></span> <span data-ttu-id="c1046-255">大多数加载项都不需要管理代理对象跟踪。</span><span class="sxs-lookup"><span data-stu-id="c1046-255">Most add-ins will not need to manage proxy object tracking.</span></span>

## <a name="see-also"></a><span data-ttu-id="c1046-256">另请参阅</span><span class="sxs-lookup"><span data-stu-id="c1046-256">See also</span></span>

- [<span data-ttu-id="c1046-257">Office 加载项的隐私和安全</span><span class="sxs-lookup"><span data-stu-id="c1046-257">Privacy and security for Office Add-ins</span></span>](../concepts/privacy-and-security.md)
- [<span data-ttu-id="c1046-258">Outlook 外接程序的激活限制和 JavaScript API</span><span class="sxs-lookup"><span data-stu-id="c1046-258">Limits for activation and JavaScript API for Outlook add-ins</span></span>](../outlook/limits-for-activation-and-javascript-api-for-outlook-add-ins.md)
- [<span data-ttu-id="c1046-259">使用 Excel JavaScript API 优化性能</span><span class="sxs-lookup"><span data-stu-id="c1046-259">Performance optimization using the Excel JavaScript API</span></span>](../excel/performance.md)
