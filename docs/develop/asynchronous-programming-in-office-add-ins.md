---
title: Office ?????????
description: ''
ms.date: 12/04/2017
ms.openlocfilehash: d251ebfd03227569b9a24bcd7f17baada6099938
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/23/2018
---
# <a name="asynchronous-programming-in-office-add-ins"></a>Office ?????????

??? Office ???? API ????????? JavaScript ??????????????????????????????????????????????? Office Web ??????????????????????????????????? Office ? JavaScript API ???????????????????? Office ?????????????????????????????????????????

API ???????????????Async????? [Document.getSelectedDataAsync](https://dev.office.com/reference/add-ins/shared/document.getselecteddataasync)?[Binding.getDataAsync](https://dev.office.com/reference/add-ins/shared/binding.getdataasync) ? [Item.loadCustomPropertiesAsync](https://dev.office.com/reference/add-ins/outlook/Office.context.mailbox.item) ????????Async??????????????????????????????????Async?????????????????????????????????????????????????????

?????????"Async"?????????????????????? Word Online ? Excel Online ?????????????"Async"??????JavaScript ?????????????????????????????????"Async"????????????????????????????????????????? Office ?????????????Word 2013 ? Excel 2013????????????????

*? 1.???????*

![?????????](../images/office15-app-async-prog-fig01.png)

?????? Web ???????????? Office ????????"??????????"??????????????????? Excel 2013 ? Excel Online ??????????????????????????????

## <a name="writing-the-callback-function-for-an-async-method"></a>??"Async"???????


??  _callback_ ?????"Async"???????????????????????????????????????? [AsyncResult](https://dev.office.com/reference/add-ins/shared/asyncresult) ????????????????


- ????????"Async"???  _callback_ ????????????"Async"????????
    
- ??????"Async"???  _callback_ ????????????
    
????????????????????????????????????????????????????????????????????"Async"?????????????


### <a name="writing-an-anonymous-callback-function"></a>????????

???????????? `result` ?????????????????? [AsyncResult.value](https://dev.office.com/reference/add-ins/shared/asyncresult.status) ???????


```js
function (result) {
        write('Selected data: ' + result.value);
}
```

??????????????"Async"??????????????????  **Document.getSelectedDataAsync** ???


- ???  _coercionType_ ?? `Office.CoercionType.Text` ?????????????????
    
- ???  _callback_ ?????????????????????????? _result_ ????? **AsyncResult** ??? **value** ??????????????????
    



```js
Office.context.document.getSelectedDataAsync(Office.CoercionType.Text, 
    function (result) {
        write('Selected data: ' + result.value);
    }
});

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```

??????????????? **AsyncResult** ???????????? [AsyncResult.status](https://dev.office.com/reference/add-ins/shared/asyncresult.error) ???????????????????????????? [AsyncResult.error](https://dev.office.com/reference/add-ins/shared/asyncresult.context) ???? [Error](https://dev.office.com/reference/add-ins/shared/error) ???????????

????  **getSelectedDataAsync** ??????????? [???????????????????????](read-and-write-data-to-the-active-selection-in-a-document-or-spreadsheet.md)? 


### <a name="writing-a-named-callback-function"></a>????????

????????????????????????"Async"???  _callback_ ??????????????????? `writeDataCallback` ????? _callback_ ????????????


```js
Office.context.document.getSelectedDataAsync(Office.CoercionType.Text, 
    writeDataCallback);

// Callback to write the selected data to the add-in UI.
function writeDataCallback(result) {
    write('Selected data: ' + result.value);
}

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```


## <a name="differences-in-whats-returned-to-the-asyncresultvalue-property"></a>?? AsyncResult.value ????????


**AsyncResult** ??? **asyncContext**?**status** ? **error** ????????????????????Async???????????????? **AsyncResult.value** ???????Async????????????

????**Binding**?[CustomXmlPart](https://dev.office.com/reference/add-ins/shared/binding)?[Document](https://dev.office.com/reference/add-ins/shared/customxmlpart.customxmlpart)?[RoamingSettings](https://dev.office.com/reference/add-ins/shared/document) ? [Settings](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ????[addHandlerAsync](https://dev.office.com/reference/add-ins/shared/settings) ?????????????????????????????????? **addHandlerAsync** ????????? **AsyncResult.value** ????????????????????????????????? **value** ????????? **undefined**?

??????????  **Document.getSelectedDataAsync** ???????????????????????? **AsyncResult.value** ???????????? [Bindings.getAllAsync](https://dev.office.com/reference/add-ins/shared/bindings.getallasync) ???????????? **Binding** ?????????????? [Bindings.getByIdAsync](https://dev.office.com/reference/add-ins/shared/bindings.getbyidasync) ????????? **Binding** ???

??????Async??? **AsyncResult.value** ????????????????????????????????????Async????????????? [AsyncResult](https://dev.office.com/reference/add-ins/shared/asyncresult) ??????????


## <a name="asynchronous-programming-patterns"></a>??????


??? Office ? JavaScript API ???????????


- ??????
    
- ??????
    
???????????????????????????????????????????????????? API ???"Async"????????

?????????? JavaScript ??????????????????????????????????????????????? Office ? JavaScript API ????????????????? Office ? JavaScript API ?????????????? [Excel ????? Word ??????](bind-to-regions-in-a-document-or-spreadsheet.md)????????

<a name="AsyncProgramming_NestedCallbacks" />
### <a name="asynchronous-programming-using-nested-callback-functions"></a>?????????????


???????????????????????????????????????????"Async"??? 

??????????????? 


- ????? [Bindings.getByIdAsync](https://dev.office.com/reference/add-ins/shared/bindings.getbyidasync) ?????????MyBinding???????????????? `result` ??? **AsyncResult** ???????? **AsyncResult.value** ?????????????
    
- ??????? `result` ????????????? [Binding.getDataAsync](https://dev.office.com/reference/add-ins/shared/binding.getdataasync) ???
    
- ??????  **Binding.getDataAsync** ?????? `result2` ?????????????
    



```js
function readData() {
    Office.context.document.bindings.getByIdAsync("MyBinding", function (result) {
        result.value.getDataAsync({ coercionType: 'text' }, function (result2) {
            write(result2.value);
        });
    });
}

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```

???????????? ??? Office ? JavaScript API ?????????

????????????????????????????????


#### <a name="using-anonymous-functions-for-nested-callbacks"></a>???????????

???????????????????????????????  **getByIdAsync** ? **getDataAsync** ????????????????????????????


```js
Office.context.document.bindings.getByIdAsync('myBinding', function (bindingResult) {
    bindingResult.value.getDataAsync(function (getResult) {
        if (getResult.status == Office.AsyncResultStatus.Failed) {
            write('Action failed. Error: ' + asyncResult.error.message);
        } else {
            write('Data has been read successfully.');
        }
    });
});

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```


#### <a name="using-named-functions-for-nested-callbacks"></a>???????????

????????????????????????????????????????????????????????????????????  `deleteAllData` ? `showResult` ???????????????????????? **getByIdAsync** ? **deleteAllDataValuesAsync** ???


```js
Office.context.document.bindings.getByIdAsync('myBinding', deleteAllData);

function deleteAllData(asyncResult) {
    asyncResult.value.deleteAllDataValuesAsync(showResult);
}

function showResult(asyncResult) {
    if (asyncResult.status == Office.AsyncResultStatus.Failed) {
        write('Action failed. Error: ' + asyncResult.error.message);
    } else {
        write('Data has been deleted successfully.');
    }
}

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```


### <a name="asynchronous-programming-using-the-promises-pattern-to-access-data-in-bindings"></a>???????????????????


????????????????????????????????????????????????????????????????? Office ???????????????????????????????????? _onError_ ?????????????????

??? Office ? JavaScript API ????? [Office.select](https://dev.office.com/reference/add-ins/shared/office.select) ???????????????????????? **Office.select** ????????????? [Binding](https://dev.office.com/reference/add-ins/shared/binding) ????????????[getDataAsync](https://dev.office.com/reference/add-ins/shared/binding.getdataasync)?[setDataAsync](https://dev.office.com/reference/add-ins/shared/binding.setdataasync)?[addHandlerAsync](https://dev.office.com/reference/add-ins/shared/asyncresult.value) ? [removeHandlerAsync](https://dev.office.com/reference/add-ins/shared/binding.removehandlerasync)?

???????????????????

 **Office.select(**_selectorExpression_,  _onError_**).**_BindingObjectAsyncMethod_

_selectorExpression_ ???? `"bindings#bindingId"` ??????_bindingId_ ???????????????????? (**id**)??? **Bindings** ????addFrom??????**addFromNamedItemAsync**?**addFromPromptAsync** ? **addFromSelectionAsync**??????????? `bindings#cities` ?????? **id** ??cities?????

_onError_ ??????????????????? **AsyncResult** ??????? **select** ????????????????? **Error** ???????????????? _onError_ ??????????????




```js
function onError(result){
    var err = result.error;
    write(err.name + ": " + err.message);
}
// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```

???? _BindingObjectAsyncMethod_ ?????????????? **Binding** ???????????**getDataAsync**?**setDataAsync**?**addHandlerAsync** ? **emoveHandlerAsync**???????????????????????[????????](#AsyncProgramming_NestedCallbacks)??????

**Binding** ???????????????????????????????????????????????? **Binding** ???????????????????????????????????????

???????? **select** ??? **Bindings** ???? **id** ??`cities`????????? [addHandlerAsync](https://dev.office.com/reference/add-ins/shared/asyncresult.value) ???????? [dataChanged](https://dev.office.com/reference/add-ins/shared/binding.bindingdatachangedevent) ???????????




```js
function addBindingDataChangedEventHandler() {
    Office.select("bindings#cities", function onError(){/* error handling code */}).addHandlerAsync(Office.EventType.BindingDataChanged,
    function (eventArgs) {
        doSomethingWithBinding(eventArgs.binding);
    });
}

```


> [!IMPORTANT]
> **Office.select** ????? **Binding** ???????? **Binding** ??????????????????? **Binding** ?????????????? **Document.bindings** ??? **Bindings.getByIdAsync** ? **Bindings.getAllAsync** ???? **Binding** ???????????? **Binding** ????????**document**?**id** ? **type** ????????? [MatrixBinding](https://dev.office.com/reference/add-ins/shared/binding.matrixbinding) ? [TableBinding](https://dev.office.com/reference/add-ins/shared/binding.tablebinding) ?????????? **getByIdAsync** ? **getAllAsync** ???? **Binding** ???


## <a name="passing-optional-parameters-to-asynchronous-methods"></a>???????????


??"??"??????????????

 _AsyncMethod_ `(`_RequiredParameters_`, [`_OptionalParameters_`],`_CallbackFunction_ `);`

?????????????????????????????????? JavaScript ????? (JSON) ???????????? JSON ????-???????????":"????????????????????????????????????????????????????

????????????? JSON ????????  `options` ??????? _options_ ?????


### <a name="passing-optional-parameters-inline"></a>????????

???????????? [Document.setSelectedDataAsync](https://dev.office.com/reference/add-ins/shared/document.setselecteddataasync) ??????????

```js
 Office.context.document.setSelectedDataAsync(data, {coercionType: 'coercionType', asyncContext:' asyncContext},callback);

```

?????????????????  _coercionType_ ? _asyncContext_ ?????????? JSON ?????

??????????????????????? **Document.setSelectedDataAsync** ???


```js
Office.context.document.setSelectedDataAsync(
    "<html><body>hello world</body></html>",
    {coercionType: "html", asyncContext: 42},
    function(asyncResult) {
        write(asyncResult.status + " " + asyncResult.asyncContext);
    }
)

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```


> [!NOTE]
> ??????? JSON ????????????????????????


### <a name="passing-optional-parameters-in-an-options-object"></a>? options ?????????

????????????  `options` ??????????????????????? `options` ???? _options_ ??????

????????  `options` ?????????? `parameter1`? `value1` ???????????????




```js
var options = {
    parameter1: value1,
    parameter2: value2,
    ...
    parameterN: valueN
};

```

???? [ValueFormat](https://dev.office.com/reference/add-ins/shared/valueformat-enumeration) ? [FilterType](https://dev.office.com/reference/add-ins/shared/filtertype-enumeration) ???????????




```js
var options = {
    valueFormat: "unformatted",
    filterType: "all"
};
```

?????  `options` ?????????




```js
var options = {};
options[parameter1] = value1;
options[parameter2] = value2;
...
options[parameterN] = valueN;
```

???? **ValueFormat** ? **FilterType** ????????????


```js
var options = {};
options["ValueFormat"] = "unformatted";
options["FilterType"] = "all";
```


> [!NOTE]
> ?????????? `options` ???????????????????????????????

????????????? `options` ???????????? **Document.setSelectedDataAsync** ???




```js
var options = {
   coercionType: "html",
   asyncContext: 42
};

document.setSelectedDataAsync(
    "<html><body>hello world</body></html>",
    options,
    function(asyncResult) {
        write(asyncResult.status + " " + asyncResult.asyncContext);
    }
)

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```


???????????_callback_ ?????????????????????????? _options_ ?????????????? JSON ??? `options` ????? _callback_ ??????????????? _callback_ ???? _option_ ???????????????????????????????????


## <a name="see-also"></a>????

- [????? Office ? JavaScript API](understanding-the-javascript-api-for-office.md) 
- [??? Office ? JavaScript API](https://dev.office.com/reference/add-ins/javascript-api-for-office)
     
