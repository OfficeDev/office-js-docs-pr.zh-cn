---
title: 使用 SSO 对 Microsoft Graph 授权
description: 了解加载项Office SSO 加载项如何使用单一登录 (SSO) 从 Microsoft Graph。
ms.date: 02/09/2021
localization_priority: Normal
ms.openlocfilehash: 054f58cf4b89d6c11cf6e7beb831eafc4a075bad
ms.sourcegitcommit: ee9e92a968e4ad23f1e371f00d4888e4203ab772
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/23/2021
ms.locfileid: "53076481"
---
# <a name="authorize-to-microsoft-graph-with-sso"></a><span data-ttu-id="dfa96-103">使用 SSO 对 Microsoft Graph 授权</span><span class="sxs-lookup"><span data-stu-id="dfa96-103">Authorize to Microsoft Graph with SSO</span></span>

<span data-ttu-id="dfa96-104">用户可以使用自己的个人 Microsoft 帐户或 Microsoft 365 教育或工作帐户，登录 Office（在线、移动和桌面平台）。</span><span class="sxs-lookup"><span data-stu-id="dfa96-104">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their Microsoft 365 Education or work account.</span></span> <span data-ttu-id="dfa96-105">在 Office 加载项中获取对 [Microsoft Graph](https://developer.microsoft.com/graph/docs) 的访问权限的最佳方式是使用用户的 Office 登录凭据。</span><span class="sxs-lookup"><span data-stu-id="dfa96-105">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="dfa96-106">这使用户能够访问其 Microsoft Graph 数据，而无需再次登录。</span><span class="sxs-lookup"><span data-stu-id="dfa96-106">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span>

> [!NOTE]
> <span data-ttu-id="dfa96-107">目前，Word、Excel、Outlook 和 PowerPoint 支持单一登录 API。</span><span class="sxs-lookup"><span data-stu-id="dfa96-107">The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="dfa96-108">若要详细了解目前支持单一登录 API 的平台，请参阅 [IdentityAPI 要求集](../reference/requirement-sets/identity-api-requirement-sets.md)。</span><span class="sxs-lookup"><span data-stu-id="dfa96-108">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
> <span data-ttu-id="dfa96-109">如果使用的是 Outlook 加载项，请务必为 Microsoft 365 租赁启用新式验证。</span><span class="sxs-lookup"><span data-stu-id="dfa96-109">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy.</span></span> <span data-ttu-id="dfa96-110">若要了解如何执行此操作，请参阅 [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx)（如何为租户启用新式体验）。</span><span class="sxs-lookup"><span data-stu-id="dfa96-110">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="dfa96-111">SSO 和 Microsoft Graph 的加载项体系结构</span><span class="sxs-lookup"><span data-stu-id="dfa96-111">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="dfa96-112">除了托管 Web 应用程序的页面和 JavaScript 之外，外接程序还必须以相同的[完全限定的域名](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly)托管一个或多个 Web API，这些 API 可获取 Microsoft Graph 的访问令牌，并向它发出请求。</span><span class="sxs-lookup"><span data-stu-id="dfa96-112">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="dfa96-113">外接程序清单包含标记，用于指定外接程序在 Azure Active Directory (Azure AD) v2.0 终结点中的注册方式，并指定外接程序需要的 Microsoft Graph 的任何权限。</span><span class="sxs-lookup"><span data-stu-id="dfa96-113">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="dfa96-114">运行时的工作方式</span><span class="sxs-lookup"><span data-stu-id="dfa96-114">How it works at runtime</span></span>

<span data-ttu-id="dfa96-115">下图展示了 Microsoft Graph 登录和访问流程的工作原理。</span><span class="sxs-lookup"><span data-stu-id="dfa96-115">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![显示 SSO 过程的图表。](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="dfa96-117">在加载项中，JavaScript 调用新的 Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-)。</span><span class="sxs-lookup"><span data-stu-id="dfa96-117">In the add-in, JavaScript calls a new Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span></span> <span data-ttu-id="dfa96-118">该操作告诉 Office 客户端应用程序获取加载项的访问令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-118">This tells the Office client application to obtain an access token to the add-in.</span></span> <span data-ttu-id="dfa96-119">（以下称为 **启动访问令牌**，因为在该过程的后期它将会被替换为另一个令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-119">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="dfa96-120">有关已解码启动访问令牌的示例，请参阅[示例访问令牌](sso-in-office-add-ins.md#example-access-token)。）</span><span class="sxs-lookup"><span data-stu-id="dfa96-120">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
2. <span data-ttu-id="dfa96-121">如果用户未登录，Office 客户端应用程序会打开弹出窗口，以供用户登录。</span><span class="sxs-lookup"><span data-stu-id="dfa96-121">If the user is not signed in, the Office client application opens a pop-up window for the user to sign in.</span></span>
3. <span data-ttu-id="dfa96-122">如果当前用户是首次使用加载项，则会看到同意提示。</span><span class="sxs-lookup"><span data-stu-id="dfa96-122">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
4. <span data-ttu-id="dfa96-123">客户端Office应用程序从当前用户的 Azure AD v2.0 终结点请求启动访问令牌。 </span><span class="sxs-lookup"><span data-stu-id="dfa96-123">The Office client application requests the **bootstrap access token** from the Azure AD v2.0 endpoint for the current user.</span></span>
5. <span data-ttu-id="dfa96-124">Azure AD 将启动令牌发送到 Office 客户端应用程序。</span><span class="sxs-lookup"><span data-stu-id="dfa96-124">Azure AD sends the bootstrap token to the Office client application.</span></span>
6. <span data-ttu-id="dfa96-125">客户端Office应用程序将启动访问令牌作为调用返回的结果对象的一部分发送到 `getAccessToken` 外接程序。</span><span class="sxs-lookup"><span data-stu-id="dfa96-125">The Office client application sends the **bootstrap access token** to the add-in as part of the result object returned by the `getAccessToken` call.</span></span>
7. <span data-ttu-id="dfa96-126">加载项中的 JavaScript 向 Web API（与加载项托管在同一完全限定的域中）发出 HTTP 请求，并添加 **启动访问令牌** 作为授权证明。</span><span class="sxs-lookup"><span data-stu-id="dfa96-126">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **bootstrap access token** as authorization proof.</span></span>
8. <span data-ttu-id="dfa96-127">服务器端代码验证传入的 **启动访问令牌**。</span><span class="sxs-lookup"><span data-stu-id="dfa96-127">Server-side code validates the incoming **bootstrap access token**.</span></span>
9. <span data-ttu-id="dfa96-128">服务器端代码使用[OAuth2](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02)令牌 Exchange 中定义的"代表"流 (以及 Web [API Azure](/azure/active-directory/develop/active-directory-authentication-scenarios)方案) 的守护程序或服务器应用程序获取 Microsoft Graph 的访问令牌，以交换启动访问令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-128">Server-side code uses the "on behalf of" flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](/azure/active-directory/develop/active-directory-authentication-scenarios)) to obtain an access token for Microsoft Graph in exchange for the bootstrap access token.</span></span>
10. <span data-ttu-id="dfa96-129">Azure AD 将 Microsoft Graph 访问令牌（如果加载项请求获取 *offline_access* 权限，则同时返回刷新令牌）返回给加载项。</span><span class="sxs-lookup"><span data-stu-id="dfa96-129">Azure AD returns the access token to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission) to the add-in.</span></span>
11. <span data-ttu-id="dfa96-130">服务器端代码缓存 Microsoft Graph 访问令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-130">Server-side code caches the access token to Microsoft Graph.</span></span>
12. <span data-ttu-id="dfa96-131">服务器端代码向 Microsoft Graph 发出请求，并添加 Microsoft Graph 访问令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-131">Server-side code makes requests to Microsoft Graph and includes the access token to Microsoft Graph.</span></span>
13. <span data-ttu-id="dfa96-132">Microsoft Graph将数据返回到加载项，加载项可以将数据传递到加载项的 UI。</span><span class="sxs-lookup"><span data-stu-id="dfa96-132">Microsoft Graph returns data to the add-in, which can pass it on to the add-in's UI.</span></span>
14. <span data-ttu-id="dfa96-133">当 Microsoft Graph 访问令牌过期时，服务器端代码可以使用其刷新令牌获取新的 Microsoft Graph 访问令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-133">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="dfa96-134">开发可访问 Microsoft Graph 的 SSO 加载项</span><span class="sxs-lookup"><span data-stu-id="dfa96-134">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="dfa96-135">开发一个可访问 Microsoft Graph 的加载项，就像可使用 SSO 的任何其他加载项一样。</span><span class="sxs-lookup"><span data-stu-id="dfa96-135">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="dfa96-136">有关完整的说明，请参阅[为 Office 加载项启用单一登录](../develop/sso-in-office-add-ins.md)。区别在于，加载项必须具有服务器端 Web API，并且我们将该文中的访问令牌成为“启动访问令牌”。</span><span class="sxs-lookup"><span data-stu-id="dfa96-136">For a thorough description, see [Enable single sign-on for Office Add-ins](../develop/sso-in-office-add-ins.md). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span>

<span data-ttu-id="dfa96-137">根据所用的语言和框架，可能存在一些库，可简化必须编写的服务器端代码。</span><span class="sxs-lookup"><span data-stu-id="dfa96-137">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write.</span></span> <span data-ttu-id="dfa96-138">代码应执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="dfa96-138">Your code should do the following:</span></span>

* <span data-ttu-id="dfa96-139">通过调用 Azure AD v2.0 终结点启动"代表"流，该终结点包括启动访问令牌、有关用户的一些元数据以及外接程序的凭据 (其 ID 和密码) 。</span><span class="sxs-lookup"><span data-stu-id="dfa96-139">Initiate the "on behalf of" flow with a call to the Azure AD v2.0 endpoint that includes the bootstrap access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="dfa96-140">创建一个或多个 Web API 方法，用于通过将可能缓存的访问令牌传递给 Microsoft Graph 来获取 Microsoft Graph 数据。</span><span class="sxs-lookup"><span data-stu-id="dfa96-140">Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token to Microsoft Graph.</span></span>
* <span data-ttu-id="dfa96-141">或者，在启动流程之前，验证从之前创建的令牌处理程序收到的加载项启动访问令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-141">Optionally, before initiating the flow, validate the add-in bootstrap access token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="dfa96-142">有关详细信息，请参阅[验证访问令牌](sso-in-office-add-ins.md#validate-the-access-token)。</span><span class="sxs-lookup"><span data-stu-id="dfa96-142">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="dfa96-143">或者，在流程完成后，将返回的访问令牌缓存到 Microsoft Graph。</span><span class="sxs-lookup"><span data-stu-id="dfa96-143">Optionally, after the flow completes, cache the returned access token to Microsoft Graph.</span></span> <span data-ttu-id="dfa96-144">如果加载项对 Microsoft Graph 进行多次调用，则需要执行此操作。</span><span class="sxs-lookup"><span data-stu-id="dfa96-144">You'll want to do this if the add-in makes more than one call to Microsoft Graph.</span></span> <span data-ttu-id="dfa96-145">有关此流的详细信息，请参阅 [Azure Active Directory v2.0 和 OAuth 2.0 代表流](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of)。</span><span class="sxs-lookup"><span data-stu-id="dfa96-145">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

> [!NOTE]
> <span data-ttu-id="dfa96-146">有关“代表”流获取的 Microsoft Graph 已解码访问令牌的示例，请参阅 [Azure Active Directory v2.0 和 OAuth 2.0 代表流](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of)。</span><span class="sxs-lookup"><span data-stu-id="dfa96-146">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="dfa96-147">有关详细演练和应用场景的示例，请参阅：</span><span class="sxs-lookup"><span data-stu-id="dfa96-147">For examples of detailed walkthroughs and scenarios, see:</span></span>

* [<span data-ttu-id="dfa96-148">创建使用单一登录的 Node.js Office 加载项</span><span class="sxs-lookup"><span data-stu-id="dfa96-148">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="dfa96-149">创建使用单一登录的 ASP.NET Office 加载项</span><span class="sxs-lookup"><span data-stu-id="dfa96-149">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="dfa96-150">应用场景：为 Outlook 加载项中的服务实现单一登录</span><span class="sxs-lookup"><span data-stu-id="dfa96-150">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](../outlook/implement-sso-in-outlook-add-in.md)

## <a name="distributing-sso-enabled-add-ins-in-microsoft-appsource"></a><span data-ttu-id="dfa96-151">在 Microsoft AppSource 中分发支持 SSO 的加载项</span><span class="sxs-lookup"><span data-stu-id="dfa96-151">Distributing SSO-enabled add-ins in Microsoft AppSource</span></span>

<span data-ttu-id="dfa96-152">当Microsoft 365从[AppSource](https://appsource.microsoft.com)获取加载项时，管理员可以通过集中式部署重新分发它，并授予加载项[](../publish/centralized-deployment.md)管理员同意以访问 Microsoft Graph作用域。</span><span class="sxs-lookup"><span data-stu-id="dfa96-152">When a Microsoft 365 admin acquires an add-in from [AppSource](https://appsource.microsoft.com), the admin can redistribute it by [centralized deployment](../publish/centralized-deployment.md) and grant admin consent to the add-in to access Microsoft Graph scopes.</span></span> <span data-ttu-id="dfa96-153">但是，最终用户也可以直接从 AppSource 获取加载项，在这种情况下，用户必须同意加载项。</span><span class="sxs-lookup"><span data-stu-id="dfa96-153">It's also possible, however, for the end user to acquire the add-in directly from AppSource, in which case the user must grant consent to the add-in.</span></span> <span data-ttu-id="dfa96-154">这可以创建一个潜在的性能问题，我们提供了一个解决方案。</span><span class="sxs-lookup"><span data-stu-id="dfa96-154">This can create a potential performance problem for which we've provided a solution.</span></span>

<span data-ttu-id="dfa96-155">如果你的代码在 调用 中传递 了 选项，例如 ，Office 如果 `allowConsentPrompt` `getAccessToken` Azure AD 向 Office报告尚未向加载项授予同意，则 Office 可以提示用户同意。 `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`</span><span class="sxs-lookup"><span data-stu-id="dfa96-155">If your code passes the `allowConsentPrompt` option in the call of `getAccessToken`, like `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`, then Office can prompt the user for consent if Azure AD reports to Office that consent has not yet been granted to the add-in.</span></span> <span data-ttu-id="dfa96-156">但是，出于安全Office，仅提示用户同意 Azure AD `profile` 作用域。</span><span class="sxs-lookup"><span data-stu-id="dfa96-156">However, for security reasons, Office can only prompt the user to consent to the Azure AD `profile` scope.</span></span> <span data-ttu-id="dfa96-157">*Office无法提示同意任何 Microsoft Graph范围，* 甚至不会 `User.Read` 。</span><span class="sxs-lookup"><span data-stu-id="dfa96-157">*Office cannot prompt for consent to any Microsoft Graph scopes*, not even `User.Read`.</span></span> <span data-ttu-id="dfa96-158">这意味着，如果用户同意提示，Office返回启动令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-158">This means that if the user grants consent on the prompt, Office will return a bootstrap token.</span></span> <span data-ttu-id="dfa96-159">但是，尝试交换启动令牌以将访问令牌交换到 Microsoft Graph 将失败，并出现错误 AADSTS65001，这意味着尚未授予 (同意 Microsoft Graph 作用域) 。</span><span class="sxs-lookup"><span data-stu-id="dfa96-159">But the attempt to exchange the bootstrap token for an access token to Microsoft Graph will fail with error AADSTS65001, which means consent (to Microsoft Graph scopes) has not been granted.</span></span>

<span data-ttu-id="dfa96-160">代码可以并且应该通过回滚到备用身份验证系统来处理此错误，这将提示用户同意 Microsoft Graph作用域。</span><span class="sxs-lookup"><span data-stu-id="dfa96-160">Your code can, and should, handle this error by falling back to an alternate system of authentication, which will prompt the user for consent to Microsoft Graph scopes.</span></span> <span data-ttu-id="dfa96-161"> (有关代码示例，请参阅创建使用单一登录的[Node.js Office](create-sso-office-add-ins-nodejs.md)加载项和创建使用单一登录的[ASP.NET Office](create-sso-office-add-ins-aspnet.md)加载项及其链接到的示例。) 但整个过程需要多次往返 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="dfa96-161">(For code examples, see [Create a Node.js Office Add-in that uses single sign-on](create-sso-office-add-ins-nodejs.md) and [Create an ASP.NET Office Add-in that uses single sign-on](create-sso-office-add-ins-aspnet.md) and the samples they link to.) But the entire process requires multiple round trips to Azure AD.</span></span> <span data-ttu-id="dfa96-162">可以通过在 调用中包括 选项来避免这种性能损失 `forMSGraphAccess` `getAccessToken` ;例如， `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )` 。</span><span class="sxs-lookup"><span data-stu-id="dfa96-162">You can avoid this performance penalty by including the `forMSGraphAccess` option in the call of `getAccessToken`; for example, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )`.</span></span>  <span data-ttu-id="dfa96-163">这表示Office加载项需要 Microsoft Graph作用域。</span><span class="sxs-lookup"><span data-stu-id="dfa96-163">This signals to Office that your add-in needs Microsoft Graph scopes.</span></span> <span data-ttu-id="dfa96-164">Office会要求 Azure AD 验证是否Graph已授予 Microsoft 许可范围。</span><span class="sxs-lookup"><span data-stu-id="dfa96-164">Office will ask Azure AD to verify that consent to Microsoft Graph scopes has already been granted to the add-in.</span></span> <span data-ttu-id="dfa96-165">如果有，将返回启动令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-165">If it has, the bootstrap token will be returned.</span></span> <span data-ttu-id="dfa96-166">如果没有，调用 将返回错误 `getAccessToken` 13012。</span><span class="sxs-lookup"><span data-stu-id="dfa96-166">If it hasn't, then the call of `getAccessToken` will return error 13012.</span></span> <span data-ttu-id="dfa96-167">代码可以通过立即回滚到备用身份验证系统来处理此错误，而无需尝试与 Azure AD 交换令牌。</span><span class="sxs-lookup"><span data-stu-id="dfa96-167">Your code can handle this error by falling back to an alternate system of authentication immediately, without making a doomed attempt to exchange tokens with Azure AD.</span></span>

<span data-ttu-id="dfa96-168">最佳做法是，始终传递到加载项在 AppSource 中分发并需要 Microsoft Graph `forMSGraphAccess` `getAccessToken` 范围。</span><span class="sxs-lookup"><span data-stu-id="dfa96-168">As a best practice, always pass `forMSGraphAccess` to `getAccessToken` when your add-in will be distributed in AppSource and needs Microsoft Graph scopes.</span></span>

> [!TIP]
> <span data-ttu-id="dfa96-169">如果您开发使用 SSO 的 Outlook 外接程序并旁加载它进行测试，Office 在传递到时将始终返回错误13012，即使已授予管理员 `forMSGraphAccess` `getAccessToken` 同意。</span><span class="sxs-lookup"><span data-stu-id="dfa96-169">If you develop an Outlook add-in that uses SSO and you sideload it for testing, Office will *always* return error 13012 when `forMSGraphAccess` is passed to `getAccessToken` even if administrator consent has been granted.</span></span> <span data-ttu-id="dfa96-170">因此，在开发加载项时，应该Outlook `forMSGraphAccess` 选项。</span><span class="sxs-lookup"><span data-stu-id="dfa96-170">For this reason, you should comment out the `forMSGraphAccess` option **when developing** an Outlook add-in.</span></span> <span data-ttu-id="dfa96-171">请确保在部署用于生产时取消对选项的注释。</span><span class="sxs-lookup"><span data-stu-id="dfa96-171">Be sure to uncomment the option when you deploy for production.</span></span> <span data-ttu-id="dfa96-172">只有在旁加载时，才能使用 Outlook。</span><span class="sxs-lookup"><span data-stu-id="dfa96-172">The bogus 13012 only happens when you are sideloading in Outlook.</span></span>
