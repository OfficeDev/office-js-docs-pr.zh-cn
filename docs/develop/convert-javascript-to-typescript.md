---
title: '? Visual Studio ?? Office ?????????? TypeScript'
description: ''
ms.date: 01/19/2018
ms.openlocfilehash: 3d5b00d2a0b014dda350888030e5a50456292e1f
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/23/2018
---
# <a name="convert-an-office-add-in-project-in-visual-studio-to-typescript"></a>? Visual Studio ?? Office ?????????? TypeScript

???? Visual Studio ?? Office ?????????? JavaScript ????????????????? TypeScript? ?? Visual Studio ???????????????? Office ??? TypeScript ??? 

????????? Visual Studio ?? Excel ?????????????? JavaScript ????? TypeScript? ????????????? Visual Studio ??????? Office ??? JavaScript ??????? TypeScript?

> [!NOTE]
> ????? Visual Studio ?? Office ??? TypeScript ???????? [5 ??????](../index.yml)???????????????????[??? Office ???? Yeoman ???](https://github.com/OfficeDev/generator-office)??????? `TypeScript`?

## <a name="prerequisites"></a>????

- ??? **Office/SharePoint ??**????? [Visual Studio 2017](https://www.visualstudio.com/vs/)

    > [!NOTE]
    > ??????? Visual Studio 2017??[?? Visual Studio ????](https://docs.microsoft.com/en-us/visualstudio/install/modify-visual-studio)?????? **Office/SharePoint ??**????? 

- TypeScript 2.3 for Visual Studio 2017

    > [!NOTE]
    > ?? TypeScript ???? Visual Studio 2017 ??????????[?? Visual Studio ????](https://docs.microsoft.com/en-us/visualstudio/install/modify-visual-studio)????????? ? Visual Studio ??????????????****????????????SDK??????****????TypeScript 2.3 SDK?****?

- Excel 2016

## <a name="create-the-add-in-project"></a>???????

1. ?? Visual Studio?? Visual Studio ?????????????**** > ????**** > ????****?

2. ??Visual C#?****??Visual Basic?****?????????????Office/SharePoint?****????????****?????Excel Web ????****??????? 

3. ?????????????****?

4. ???? Office ????****????????????????? Excel?****????????****??????

5. ???Visual Studio ????????????????????????????****??**Home.html** ??? Visual Studio ????

## <a name="convert-the-add-in-project-to-typescript"></a>??????????? TypeScript

1. ????????????****??? **Home.js** ?????? **Home.ts**?

    > [!NOTE]
    > ? TypeScript ?????????? TypeScript ? JavaScript ????????????????? TypeScript ???? JavaScript ??????? JavaScript? 

2. ????????????****?????????????

3. ? Web ??????????? **Office.d.ts** ???

4. ? Web ??????? [Office.js ???????](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts)? ??????????????

5. ? Visual Studio ???? **Office.d.ts** ????????????????????????

6. ? Web ??????????? **jQuery.d.ts** ???

7. ? Web ??????? [jQuery ???????](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/jquery/index.d.ts)? ??????????????

8. ? Visual Studio ???? **jQuery.d.ts** ????????????????????????

9. ? Visual Studio ???? Web ?????????? **tsconfig.json** ???

10. ?? **tsconfig.json** ?????????????????????

    ```javascript
    {
        "compilerOptions": {
            "skipLibCheck": true,
            "lib": [ "es5", "dom", "es2015.promise" ]
        }
    }
    ```

11. ?? **Home.ts** ????????????????

    ```javascript
    declare var fabric: any;
    ```

12. ? **Home.ts** ???????????? **'1.1'** ??? **1.1**??????????????

    ```javascript
    if (!Office.context.requirements.isSetSupported('ExcelApi', '1.1')) {
    ```

## <a name="run-the-converted-add-in-project"></a>???????????

1. ? Visual Studio ??? F5 ???????****????? Excel????????????????****?????????????? IIS ??

2. ? Excel ??????????****?????????????????****?????????????

3. ???????????????????

4. ?????????????****????????????????????????

## <a name="homets-code-file"></a>Home.ts ????

???????????????????????? **Home.ts** ????? ??????????????????

```javascript
declare var fabric: any;

(function () {
    "use strict";

    var cellToHighlight;
    var messageBanner;

    // The initialize function must be run each time a new page is loaded.
    Office.initialize = function (reason) {
        $(document).ready(function () {
            // Initialize the FabricUI notification mechanism and hide it
            var element = document.querySelector('.ms-MessageBanner');
            messageBanner = new fabric.MessageBanner(element);
            messageBanner.hideBanner();
            
            // If not using Excel 2016, use fallback logic.
            if (!Office.context.requirements.isSetSupported('ExcelApi', 1.1)) {
                $("#template-description").text("This sample will display the value of the cells that you have selected in the spreadsheet.");
                $('#button-text').text("Display!");
                $('#button-desc').text("Display the selection");

                $('#highlight-button').click(displaySelectedCells);
                return;
            }

            $("#template-description").text("This sample highlights the highest value from the cells you have selected in the spreadsheet.");
            $('#button-text').text("Highlight!");
            $('#button-desc').text("Highlights the largest number.");
                
            loadSampleData();

            // Add a click event handler for the highlight button.
            $('#highlight-button').click(hightlightHighestValue);
        });
    };

    function loadSampleData() {
        var values = [
            [Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000)],
            [Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000)],
            [Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000)]
        ];

        // Run a batch operation against the Excel object model
        Excel.run(function (ctx) {
            // Create a proxy object for the active sheet
            var sheet = ctx.workbook.worksheets.getActiveWorksheet();
            // Queue a command to write the sample data to the worksheet
            sheet.getRange("B3:D5").values = values;

            // Run the queued-up commands, and return a promise to indicate task completion
            return ctx.sync();
        })
        .catch(errorHandler);
    }

    function hightlightHighestValue() {
        // Run a batch operation against the Excel object model
        Excel.run(function (ctx) {
            // Create a proxy object for the selected range and load its properties
            var sourceRange = ctx.workbook.getSelectedRange().load("values, rowCount, columnCount");

            // Run the queued-up command, and return a promise to indicate task completion
            return ctx.sync()
                .then(function () {
                    var highestRow = 0;
                    var highestCol = 0;
                    var highestValue = sourceRange.values[0][0];

                    // Find the cell to highlight
                    for (var i = 0; i < sourceRange.rowCount; i++) {
                        for (var j = 0; j < sourceRange.columnCount; j++) {
                            if (!isNaN(sourceRange.values[i][j]) && sourceRange.values[i][j] > highestValue) {
                                highestRow = i;
                                highestCol = j;
                                highestValue = sourceRange.values[i][j];
                            }
                        }
                    }

                    cellToHighlight = sourceRange.getCell(highestRow, highestCol);
                    sourceRange.worksheet.getUsedRange().format.fill.clear();
                    sourceRange.worksheet.getUsedRange().format.font.bold = false;

                    // Highlight the cell
                    cellToHighlight.format.fill.color = "orange";
                    cellToHighlight.format.font.bold = true;
                })
                .then(ctx.sync);
        })
        .catch(errorHandler);
    }

    function displaySelectedCells() {
        Office.context.document.getSelectedDataAsync(Office.CoercionType.Text,
            function (result) {
                if (result.status === Office.AsyncResultStatus.Succeeded) {
                    showNotification('The selected text is:', '"' + result.value + '"');
                } else {
                    showNotification('Error', result.error.message);
                }
            });
    }

    // Helper function for treating errors
    function errorHandler(error) {
        // Always be sure to catch any accumulated errors that bubble up from the Excel.run execution
        showNotification("Error", error);
        console.log("Error: " + error);
        if (error instanceof OfficeExtension.Error) {
            console.log("Debug info: " + JSON.stringify(error.debugInfo));
        }
    }

    // Helper function for displaying notifications
    function showNotification(header, content) {
        $("#notification-header").text(header);
        $("#notification-body").text(content);
        messageBanner.showBanner();
        messageBanner.toggleExpansion();
    }
})();
```

## <a name="see-also"></a>????

* [StackOverflow ??????????](https://stackoverflow.com/questions/44461312/office-addins-file-in-its-typescript-version-doesnt-work)
* [GitHub ?? Office ??????](https://github.com/officedev)
