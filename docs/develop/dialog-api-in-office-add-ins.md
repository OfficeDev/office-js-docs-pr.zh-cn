---
title: '? Office ?????????? API'
description: ''
ms.date: 12/04/2017
ms.openlocfilehash: b026c3c5871372c52d0b44e36c01fc44a3d2bf04
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/23/2018
---
# <a name="use-the-dialog-api-in-your-office-add-ins"></a>? Office ????????? API

??? Office ???????[??? API](https://dev.office.com/reference/add-ins/shared/officeui) ???????????????? Office ?????????? API ????

> [!NOTE]
> ??????? API ????????????[??? API ???](https://dev.office.com/reference/add-ins/requirement-sets/dialog-api-requirement-sets)????Word?Excel?PowerPoint ? Outlook ????? API?

> ??? API ????????? Google ? Facebook ?????????? ?????????? Microsoft Graph ?? Office ??????????? Office 365 ? OneDrive????????????? API? ???????? API??????? Dialog API? ??????????[? Office ?????????](sso-in-office-add-ins.md)?

????????/?????/[?????](../design/add-in-commands.md)???????????????

- ???????????????????
- ???????????????????????????
- ????????????????

> [!NOTE]
> ??????? UI ??????????????????????????????????????????????????????????????????? [Excel ??? JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker) ???

???????????

![?????](../images/auth-o-dialog-open.png)

???????????????????????????????????*???*????????????????? Office ????????????????????????????

## <a name="dialog-api-scenarios"></a>Dialog API ????

Office JavaScript API ??????????? [Office.context.ui ????](https://dev.office.com/reference/add-ins/shared/officeui)??? [Dialog](https://dev.office.com/reference/add-ins/shared/officeui.dialog) ????????

### <a name="open-a-dialog-box"></a>?????

?????????????????? [displayDialogAsync](https://dev.office.com/reference/add-ins/shared/officeui.displaydialogasync) ??????????? URL ??????????????????? MVC ?????????????Web ??????????????????????????????????????????????????

```js
Office.context.ui.displayDialogAsync('https://myAddinDomain/myDialog.html');
```

> [!NOTE]
> - URL ?? HTTP**S** ?????????????????????????????????????
> - ????????????????????????????????????[????](https://dev.office.com/reference/add-ins/manifest/functionfile)???????? `displayDialogAsync` ?????????????????????????????

????????????????????????? HTTPS ?????????????????????????????????????

????????????????????? 80%???????????????????????????????????????

```js
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html', {height: 30, width: 20});
```

????????????????? [Office ??? Dialog API ??](https://github.com/OfficeDev/Office-Add-in-Dialog-API-Simple-Example)?

???????? 100% ????????????????? 99.5%??????????????

> [!NOTE]
> ????????????????????????????????????????????????????????????????????????????????????????????[?????](../design/add-in-commands.md)?????????????????? HTML ??????????????????????????????????????????????????????? [displayDialogAsync ?????](#errors-from-displaydialogasync)?

### <a name="take-advantage-of-a-performance-option-in-office-online"></a>?? Office Online ??????

???????? `displayDialogAsync` ????????????????????? `true`?????? Office Online ????????????????? iframe?????????????????????????????????`displayInIframe`

```js
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html', {height: 30, width: 20, displayInIframe: true});
```

???? `false`????????????? ???????? Office Online ????`displayInIframe` ?????

> [!NOTE]
> ?????????????? iframe ???????**?**??? `displayInIframe: true`???????? Web ???? Google ? Microsoft ??????????? iframe ????

### <a name="send-information-from-the-dialog-box-to-the-host-page"></a>?????????????

???????????????????????

- ????????????????????
- Office JavaScript ????????????? Office JavaScript ???????????????? `Office.initialize` ???????????????????????????[???????](understanding-the-javascript-api-for-office.md#initializing-your-add-in)??

?????????? `messageParent` ???????????????????????????????XML blob????? JSON ???????????????????????

```js
if (loginSuccess) {
    Office.context.ui.messageParent(true);
}
```

> [!NOTE]
> - ???*??*???????????? Office API ??????? `Office.context.requirements.isSetSupported`???????????[?? Office ??? API ??](specify-office-hosts-and-api-requirements.md)?`messageParent`
> - ??????????????????????????????`messageParent`

????????`googleProfile` ??? Google ????????????

```js
if (loginSuccess) {
    Office.context.ui.messageParent(googleProfile);
}
```

???????????????????? `displayDialogAsync` ??????????????? `DialogMessageReceived` ??????????????

```js
var dialog;
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html', {height: 30, width: 20},
    function (asyncResult) {
        dialog = asyncResult.value;
        dialog.addEventHandler(Office.EventType.DialogMessageReceived, processMessage);
    }
);
```

> [!NOTE]
> - Office ? [AsyncResult](https://dev.office.com/reference/add-ins/shared/asyncresult) ??????????????????????????????????????????????????[???????](#handle-errors-and-events)???
> - ? `value` ????? [Dialog](https://dev.office.com/reference/add-ins/shared/officeui.dialog) ???????????????????????????`asyncResult`
> - ??????????????????????`processMessage`
> - ??????????????? `processMessage` ?????????`dialog`

????? `DialogMessageReceived` ????????????

```js
function processMessage(arg) {
    var messageFromDialog = JSON.parse(arg.message);
    showUserName(messageFromDialog.name);
}
```

> [!NOTE]
> - Office ? `arg` ???????????? `message` ???????? `messageParent` ????????????????????? Microsoft ??? Google ??????????????????????? `JSON.parse` ??????????
> - ??? `showUserName` ??????????????????????

????????????????????????????????????

```js
function processMessage(arg) {
    dialog.close();
    // message processing code goes here;
}
```

> [!NOTE]
> - ????? `displayDialogAsync` ????????`dialog`
> - ???? Office ????????`dialog.close`

?????????????????? [Office ?????? API ??](https://github.com/OfficeDev/Office-Add-in-Dialog-API-Simple-Example)?

????????????????????????????? `window.location.replace` ???? `window.location.href`??????????????????

```js
function processMessage(arg) {
    // message processing code goes here;
    window.location.replace("/newPage.html");
    // Alternatively ...
    // window.location.href = "/newPage.html";
}
```

?????????????????[? PowerPoint ?????? Microsoft Graph ?? Excel ??](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart)???

#### <a name="conditional-messaging"></a>????
???????????? `messageParent` ????????????? `DialogMessageReceived` ????????????????????????????????????????????????????? Microsoft ??? Google????????????????????????????????????????????????????

```js
if (loginSuccess) {
    var userProfile = getProfile();
    var messageObject = {messageType: "signinSuccess", profile: userProfile};            
    var jsonMessage = JSON.stringify(messageObject);
    Office.context.ui.messageParent(jsonMessage);
} else {
    var errorDetails = getError();
    var messageObject = {messageType: "signinFailure", error: errorDetails};            
    var jsonMessage = JSON.stringify(messageObject);
    Office.context.ui.messageParent(jsonMessage);
}
```

> [!NOTE]
> - ??????????????? HTTP ????????`loginSuccess`
> - ??? `getProfile` ? `getError` ?????????????????? HTTP ??????????
> - ????????????????????????? `messageType` ????????????? `profile` ??????? `error` ???

????????????????
- [?? Auth0 ????????? Office ???](https://github.com/OfficeDev/Office-Add-in-Auth0)
- [?? OAuth.io ????????????? Office ???](https://github.com/OfficeDev/Office-Add-in-OAuth.io)

????????????? `messageType` ??????????????????????`showUserName` ??????????????`showNotification` ??????? UI ??????

```js
function processMessage(arg) {
    var messageFromDialog = JSON.parse(arg.message);
    if (messageFromDialog.messageType === "signinSuccess") {
        dialog.close();
        showUserName(messageFromDialog.profile.name);
        window.location.replace("/newPage.html");
    } else {
        dialog.close();
        showNotification("Unable to authenticate user: " + messageFromDialog.error);
    }
}
```

### <a name="closing-the-dialog-box"></a>?????

???????????????????????????????????? `messageParent` ????????????????????

```js
function closeButtonClick() {
    var messageObject = {messageType: "dialogClosed"};            
    var jsonMessage = JSON.stringify(messageObject);
    Office.context.ui.messageParent(jsonMessage);
}
```

??????????? `dialog.close`??????????????????????????????????????`DialogMessageReceived`


```js
function processMessage(arg) {
    var messageFromDialog = JSON.parse(arg.message);
    if (messageFromDialog.messageType === "dialogClosed") {
       dialog.close();
    }
}
```

?????????????? [Office ????????????](https://github.com/OfficeDev/Office-Add-in-UX-Design-Patterns-Code)?????[?????????](https://github.com/OfficeDev/Office-Add-in-UX-Design-Patterns-Code/tree/master/templates/dialog/navigation)?

????????????? UI???????????????? **X** ???????????? `DialogEventReceived` ?????????????????????????????????????????????[????????????](#errors-and-events-in-the-dialog-window)???

## <a name="handle-errors-and-events"></a>???????

??????????

- ??????????????????`displayDialogAsync`
- ???????????????

### <a name="errors-from-displaydialogasync"></a>DisplayDialogAsync ?????

??????????????? `displayDialogAsync` ????????????

|????|??|
|:-----|:-----|
|12004|??? `displayDialogAsync` ? URL ??????????????????????????????|
|12005|??? `displayDialogAsync` ? URL ?? HTTP ??????? HTTPS??? Office ????????? 12005 ???????? 12004 ??????????|
|<span id="12007">12007</span>|???????????????????????????????????????|

?? `displayDialogAsync` ?????? [AsyncResult](https://dev.office.com/reference/add-ins/shared/asyncresult) ??????????????????????????????`AsyncResult` ??? `value` ??? [Dialog](https://dev.office.com/reference/add-ins/shared/officeui.dialog) ???????????[?????????????](#send-information-from-the-dialog-box-to-the-host-page)??????? `displayDialogAsync` ??????????`AsyncResult` ??? `status` ??????failed?????????? `error` ?????????????? `status`???????????????????????????????????????????

```js
var dialog;
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html',
function (asyncResult) {
    if (asyncResult.status === "failed") {
        showNotification(asynceResult.error.code = ": " + asyncResult.error.message);
    } else {
        dialog = asyncResult.value;
        dialog.addEventHandler(Office.EventType.DialogMessageReceived, processMessage);
    }
});
```

### <a name="errors-and-events-in-the-dialog-window"></a>????????????

???????????????????????????? `DialogEventReceived` ???

|????|??|
|:-----|:-----|
|12002|???????<br> - ??? `displayDialogAsync` ? URL ????????<br> - ??? `displayDialogAsync` ??????????????????????????????????????? URL?|
|12003|???????? HTTP ??? URL????? HTTPS?|
|12006|????????????????? **X** ???|

??????? `displayDialogAsync` ??? `DialogEventReceived` ???????????????????

```js
var dialog;
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html',
    function (result) {
        dialog = result.value;
        dialog.addEventHandler(Office.EventType.DialogEventReceived, processDialogEvent);
    }
);
```

??????????????????? `DialogEventReceived` ??????????????????

```js
function processDialogEvent(arg) {
    switch (arg.error) {
        case 12002:
            showNotification("The dialog box has been directed to a page that it cannot find or load, or the URL syntax is invalid.");
            break;
        case 12003:
            showNotification("The dialog box has been directed to a URL with the HTTP protocol. HTTPS is required.");            break;
        case 12006:
            showNotification("Dialog closed.");
            break;
        default:
            showNotification("Unknown error in dialog box.");
            break;
    }
}
```

?????????????????? [Office ??? Dialog API ??](https://github.com/OfficeDev/Office-Add-in-Dialog-API-Simple-Example)?


## <a name="pass-information-to-the-dialog-box"></a>????????

????????????????????????????????

- ???? `displayDialogAsync` ? URL ???????
- ??????????????????????????????????????*??????????*????????????????[????](http://www.w3schools.com/html/html5_webstorage.asp)?

### <a name="use-local-storage"></a>??????

???????????????????? `window.localStorage` ??? `setItem` ???????? `displayDialogAsync`?????????

```js
localStorage.setItem("clientID", "15963ac5-314f-4d9b-b5a1-ccb2f1aea248");
```

??????????????????????????

```js
var clientID = localStorage.getItem("clientID");
// You can also use property syntax:
// var clientID = localStorage.clientID;
```

?????????????????????????

- [?? Auth0 ????????? Office ???](https://github.com/OfficeDev/Office-Add-in-Auth0)
- [?? OAuth.io ????????????? Office ???](https://github.com/OfficeDev/Office-Add-in-OAuth.io)

### <a name="use-query-parameters"></a>??????

?????????????????????

```js
Office.context.ui.displayDialogAsync('https://myAddinDomain/myDialog.html?clientID=15963ac5-314f-4d9b-b5a1-ccb2f1aea248');
```

??????????????[? PowerPoint ?????? Microsoft Graph ?? Excel ??](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart)?

????????????? URL????????

> [!NOTE]
> Office ??????? `displayDialogAsync` ? URL ?????? `_host_info`??????????????????????????????????? URL??Microsoft ????????????????????????????????????????????????????????*????????????????*?

## <a name="use-the-dialog-apis-to-show-a-video"></a>????? API ????

????????????????????

1.  ?????? iframe ????iframe ? `src` ??????????? URL ???? HTTP**S** ????????????video.dialogbox.html????????????

    ```HTML
    <iframe class="ms-firstrun-video__player"  width="640" height="360"
        src="https://www.youtube.com/embed/XVfOe5mFbAE?rel=0&autoplay=1"
        frameborder="0" allowfullscreen>
    </iframe>
    ```

2.  video.dialogbox.html ???????????????
3.  ??????? `displayDialogAsync`??? video.dialogbox.html?
4.  ?????????????????????? `DialogEventReceived` ???????????? 12006 ?????????????[????????????](#errors-and-events-in-the-dialog-window)???

?????????????????? [Office ?????????????](https://github.com/OfficeDev/Office-Add-in-UX-Design-Patterns-Code)?????[??????????](https://github.com/OfficeDev/Office-Add-in-UX-Design-Patterns-Code/tree/master/templates/first-run/video-placemat)?

![??????????????????](../images/video-placemats-dialog-open.png)

## <a name="use-the-dialog-apis-in-an-authentication-flow"></a>???????????? API

??? API ????????????? Iframe ?????????????????? Microsoft ???Office 365?Google ? Facebook????????

> [!NOTE]
> ?????? API ?????????*?*??? `displayDialogAsync` ??? `displayInIframe: true` ???????????[?? Office Online ??????](#take-advantage-of-a-performance-option-in-office-online)?????????

????????????????

1. ??????????????????????????????????????????????????? UI???????????????????????? *NAME-OF-PROVIDER* ???????????????????????????????????? URL??[????????](#pass-information-to-the-dialog-box)????
2. ????????????????URL ??????????????????????????????????????????????????? "redirectPage.html"??*????????????????*????????????????????????? `messageParent`????????????????????????
2. ????????????????????? GET ??????????????????????? redirectPage.html??????????????????????????????????????????????????????????????????????????????????????????????? redirectPage.html????????????? **X** ?????????????????????????? redirectPage.html?????????????????
3. ? redirectPage.html ?????????? `messageParent` ????????????????????????????????
4. ?????????????????????????????????????`DialogMessageReceived`

???????????????????

- [? PowerPoint ??????? Microsoft Graph ?? Excel ??](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart)??????????????????????????????????? Office 365 ????
- [Office ???? Office 365 ??? AngularJS ????](https://github.com/OfficeDev/Word-Add-in-AngularJS-Client-OAuth)???????????????????

#### <a name="support-multiple-identity-providers"></a>??????????

?????????????????? Microsoft ???Google ? Facebook???????????????????????????????????? UI??????????? URL ????????? URL?

??????????????[?? Auth0 ????????? Office ????](https://github.com/OfficeDev/Office-Add-in-Auth0)?

#### <a name="authorization-of-the-add-in-to-an-external-resource"></a>????????????

???????Web ?????????????????????????????????? Office 365?Google Plus?Facebook ? LinkedIn??????????????????????????????????

- ???????????????????
- ??????????????????????? URL?  

????????????????????????????????????????????????????????????????????????????????? URL????????????????????????

??????? API ??????????????????????????????????

- ???????????????????????????????????????
- ??????? `messageParent` ???????????????????????????????????????????????????????????????????????????????????????????

?????????? API ??????
- [? PowerPoint ??????? Microsoft Graph ?? Excel ??](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) - ?????????????
- [?? OAuth.io ????????????? Office ???](https://github.com/OfficeDev/Office-Add-in-OAuth.io)

???????????????????????
- [? Office ??????????](auth-external-add-ins.md)
- [Office JavaScript API ?????](https://github.com/OfficeDev/office-js-helpers)


## <a name="use-the-office-dialog-api-with-single-page-applications-and-client-side-routing"></a>? Office Dialog API ?????????????????

??????????????????????????????????? URL ??? [ displayDialogAsync ](http://dev.office.com/reference/add-ins/shared/officeui.displaydialogasync) ???????????? HTML ??? URL?

> [!IMPORTANT]
>??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
