---
title: ??????????
description: ''
ms.date: 12/04/2017
ms.openlocfilehash: b4d1cdf2ce127d140153b6db02bc9a337a37bb5d
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/23/2018
---
# <a name="persisting-add-in-state-and-settings"></a>??????????

Office ??????????????????????? Web ????????????????????????????????????????????????????????????????????????????????????????????????????????????

- ????? Office ? JavaScript API ??????????
    -  ??????????????????????-????
    -  ?????????? XML?
    
- ?????????????????? Cookie ? HTML5 Web ???[localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ? [sessionStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage)??
    
????????????? Office ? JavaScript API ???????????????? Cookie ? Web ????????? [Excel-Add-in-JavaScript-PersistCustomSettings](https://github.com/OfficeDev/Excel-Add-in-JavaScript-PersistCustomSettings)?

## <a name="persisting-add-in-state-and-settings-with-the-javascript-api-for-office"></a>????? Office ? JavaScript API ??????????

??? Office ? JavaScript API ?????????????????? [Settings](https://dev.office.com/reference/add-ins/shared/settings)? [RoamingSettings](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ? [CustomProperties](https://dev.office.com/reference/add-ins/outlook/CustomProperties) ?????????????????????????????????? [Id](https://dev.office.com/reference/add-ins/manifest/id) ????

|**??**|**????????**|**????**|**Office ????**|
|:-----|:-----|:-----|:-----|
|[??](https://dev.office.com/reference/add-ins/shared/settings)|???????|??????????????????????????????????????????????????????????<br/><br/>**?????**???? **Settings** ?????????????????? (PII)??????????????????????????????????????????????????????? PII ??????????????? PII ????????????????????????|Word?Excel ? PowerPoint<br/><br/> **???** Project 2013 ??????????????????????? **Settings** API??????? Project???? Office ???????????????????? Cookie ? Web ???????????????????? [Excel-Add-in-JavaScript-PersistCustomSettings](https://github.com/OfficeDev/Excel-Add-in-JavaScript-PersistCustomSettings)? |
|[RoamingSettings](https://dev.office.com/reference/add-ins/outlook/RoamingSettings)|Outlook|????????? Exchange ??????????????????????????????????????????????????????????????????????????????????????<br/><br/> Outlook ?????????????????????????????????????|Outlook|
|[CustomProperties](https://dev.office.com/reference/add-ins/outlook/CustomProperties)|Outlook|??????????????????? Outlook ????????????????????????????????????????|Outlook|
|[CustomXmlParts](https://dev.office.com/reference/add-ins/shared/customxmlparts.customxmlparts)|????|???????????????????????????????????????????????????????<br/><br/>**?????**????????????????? (PII) ?????? XML ?????????????????????????????????????????????????????????? PII ??????????????? PII ??????????????????????????|Word??? Office JavaScript ?? API??Excel??????? Excel JavaScript API?|

## <a name="settings-data-is-managed-in-memory-at-runtime"></a>??????????????

> [!NOTE]
> ??????? Office ?? JavaScript API ?????????? ???? Excel JavaScript API ??????????????? Excel API ??????????? ?????????? [Excel SettingCollection](https://dev.office.com/reference/add-ins/excel/settingcollection)?

??????  **Settings**? **CustomProperties** ? **RoamingSettings** ??????????????????? JavaScript ????? (JSON) ???????/??????????????? **string**???????? JavaScript  **string**? **number**? **date** ? **object**?????  **function**?

???????????????  **string** ????? `firstName`? `location` ? `defaultView`?

```json
{
    "firstName":"Erik",
    "location":"98052",
    "defaultView":"basic"
}
```

???????????????????????????????????????????????????????????????????????????????????????? **Settings**? **CustomProperties** ? **RoamingSettings**?? **get**? **set** ? **remove** ??????????? 


> [!IMPORTANT]
> ???????????????????????????????????????????????????? **saveAsync** ???**get**?**set** ? **remove** ???? settings ??????????????????????? **saveAsync** ??????????????????????????????? 


## <a name="how-to-save-add-in-state-and-settings-per-document-for-content-and-task-pane-add-ins"></a>??????????????????????????


??? Word?Excel ? PowerPoint ???????????????????????? [Settings](https://dev.office.com/reference/add-ins/shared/settings) ????????? **Settings** ???????????????????????????????????????????????

**Settings** ??????? [Document](https://dev.office.com/reference/add-ins/shared/document) ???????????????????????????? **Document** ????????? **Document** ??? [settings ](https://dev.office.com/reference/add-ins/shared/document.settings)???? **Settings** ??????????????????? **Settings.get**?**Settings.set** ? **Settings.remove** ????????????????????????????????

?? set ? remove ??????????????????????????????????????????? [Settings.saveAsync](https://dev.office.com/reference/add-ins/shared/settings.saveasync) ???


### <a name="creating-or-updating-a-setting-value"></a>????????

???????????? [Settings.set](https://dev.office.com/reference/add-ins/shared/settings.set) ?????? `'themeColor'` ??? `'green'` ????set ??????????????????? _name_ (Id)????????????????? _value_?


```js
Office.context.document.settings.set('themeColor', 'green');
```

 ????????????????????????????????????????? **Settings.saveAsync** ???????????????????


### <a name="getting-the-value-of-a-setting"></a>??????

??????????? [Settings.get](https://dev.office.com/reference/add-ins/shared/settings.get) ???????themeColor??????**get** ??????????? _name_????????


```js
write('Current value for mySetting: ' + Office.context.document.settings.get('themeColor'));

// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```

 **get** ???????????? _name_ ???????????????????? **null**?


### <a name="removing-a-setting"></a>????

??????????? [Settings.remove](https://dev.office.com/reference/add-ins/shared/settings.removehandlerasync) ???????themeColor?????**remove** ??????????? _name_????????


```js
Office.context.document.settings.remove('themeColor');
```

???????????????????? **Settings.saveAsync** ????????????????


### <a name="saving-your-settings"></a>????

?????????????????????????????????????????? [Settings.saveAsync](https://dev.office.com/reference/add-ins/shared/settings.saveasync) ?????????????**saveAsync** ??????????????????? _callback_? 


```js
Office.context.document.settings.saveAsync(function (asyncResult) {
    if (asyncResult.status == Office.AsyncResultStatus.Failed) {
        write('Settings save failed. Error: ' + asyncResult.error.message);
    } else {
        write('Settings saved.');
    }
});
// Function that writes to a div with id='message' on the page.
function write(message){
    document.getElementById('message').innerText += message; 
}
```

????????????  **callback** ???? _saveAsync_ ???????????? _asyncResult_ ???????????? **AsyncResult** ????????????????? **AsyncResult.status** ??????????????????????????????

## <a name="how-to-save-custom-xml-to-the-document"></a>?????? XML ?????

> [!NOTE]
> ????? Word ???? Office ?? JavaScript API ?????????? XML ??? ???? Excel JavaScript API ??????? XML ???????? Excel API ??????????? ?????????? [Excel CustomXmlPart](https://dev.office.com/reference/add-ins/excel/customxmlpart)?

???????????????????????????????????????? ??? Word ????????????? XML ?????? Excel??????????????? ? Word ???? [CustomXmlPart](https://dev.office.com/reference/add-ins/shared/customxmlpart.customxmlpart) ???????????? Excel????????????????????? XML ???????? div ????? ID ???? ????XML ??????? `xmlns` ???

```js
function createCustomXmlPart() {
    const xmlString = "<Reviewers xmlns='http://schemas.contoso.com/review/1.0'><Reviewer>Juan</Reviewer><Reviewer>Hong</Reviewer><Reviewer>Sally</Reviewer></Reviewers>";
    Office.context.document.customXmlParts.addAsync(xmlString,
        (asyncResult) => {
            $("#xml-id").text("Your new XML part's ID: " + asyncResult.id);
            asyncResult.value.getXmlAsync(
                (asyncResult) => {
                    $("#xml-blob").text(asyncResult.value);                    
                }
            );
        }
    );
}
```

??????? XML ?????? [getByIdAsync](https://dev.office.com/reference/add-ins/shared/customxmlparts.getbyidasync) ???? ID ???? XML ?????? GUID?????????? ID ???? ????????? XML ??????? XML ??? ID ??????????????????? ???????????????? ????????????????????????????????????????

 ```js
function createCustomXmlPartAndStoreId() {
    const xmlString = "<Reviewers xmlns='http://schemas.contoso.com/review/1.0'><Reviewer>Juan</Reviewer><Reviewer>Hong</Reviewer><Reviewer>Sally</Reviewer></Reviewers>";
    Office.context.document.customXmlParts.addAsync(xmlString,
        (asyncResult) => {
            Office.context.document.settings.set('ReviewersID', asyncResult.id);
            Office.context.document.settings.saveAsync();
        }
    );
}
```

??????????????????? ID ??? XML ???

 ```js
function getReviewers() {
    const reviewersXmlId = Office.context.document.settings.get('ReviewersID'));
    Office.context.document.customXmlParts.getByIdAsync(reviewersXmlId, 
        (asyncResult) => {
            asyncResult.value.getXmlAsync(
                (asyncResult) => {
                    $("#xml-blob").text(asyncResult.value);                    
                }
            );
        }
    );
}
```


## <a name="how-to-save-settings-in-the-users-mailbox-for-outlook-add-ins-as-roaming-settings"></a>????????? Outlook ?????????????


 Outlook ???????? [RoamingSettings](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ????????????????????????? ??????? Outlook ?????????????????? ???????? Exchange Server ????????????????????? Outlook ????????


### <a name="loading-roaming-settings"></a>??????


Outlook ??????? [Office.initialize](https://dev.office.com/reference/add-ins/shared/office.initialize) ???????????????? JavaScript ??????????????????


```js
var _mailbox;
var _settings;

// The initialize function is required for all add-ins.
Office.initialize = function (reason) {
    // Checks for the DOM to load using the jQuery ready function.
    $(document).ready(function () {
    // After the DOM is loaded, add-in-specific code can run.
   // Initialize instance variables to access API objects.
    _mailbox = Office.context.mailbox;
    _settings = Office.context.roamingSettings;
    });
}

```


### <a name="creating-or-assigning-a-roaming-setting"></a>?????????


????????????  `setAppSetting` ???????? [RoamingSettings.set](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ???????????????? `cookie` ???????? [RoamingSettings.saveAsync](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ???????????? Exchange Server?


```js
// Set an add-in setting.
function setAppSetting() {
    _settings.set("cookie", Date());
    _settings.saveAsync(saveMyAppSettingsCallback);
}

// Saves all roaming settings.
function saveMyAppSettingsCallback(asyncResult) {
    if (asyncResult.status == Office.AsyncResultStatus.Failed) {
        // Handle the failure.
    }
}
```

**saveAsync** ????????????????????????????????? `saveMyAppSettingsCallback` ???????? **saveAsync** ???????????`saveMyAppSettingsCallback` ??? _asyncResult_ ????? [AsyncResult](https://dev.office.com/reference/add-ins/outlook/simple-types) ????????????????? **AsyncResult.status** ?????????????


### <a name="removing-a-roaming-setting"></a>??????


?????????????  `removeAppSetting` ????????? [RoamingSettings.remove](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ???? `cookie` ????????????? Exchange Server?


```js
// Remove an application setting.
function removeAppSetting()
{
    _settings.remove("cookie");
    _settings.saveAsync(saveMyAppSettingsCallback);
}
```


## <a name="how-to-save-settings-per-item-for-outlook-add-ins-as-custom-properties"></a>?????? Outlook ???????????????


??????? Outlook ??????????????????????? Outlook ?????????????????????????????????????????????????????Outlook ?????????????

?????????????????????????????????  [Item](https://dev.office.com/reference/add-ins/outlook/Office.context.mailbox.item) ??? **loadCustomPropertiesAsync** ?????????????????????????????????? Exchanger Server ????????????????????? [CustomProperties](https://dev.office.com/reference/add-ins/outlook/CustomProperties) ??? [set](https://dev.office.com/reference/add-ins/outlook/RoamingSettings) ? **get** ?????????????????????????????????????????? [saveAsync](https://dev.office.com/reference/add-ins/outlook/CustomProperties) ??? Exchanger Server????????????


### <a name="custom-properties-example"></a>???????

??????????????? Outlook ????????????????????????????? Outlook ???????? 

??????? Outlook ???????  `_customProps` ???? **get** ??????????????????????




```js
var property = _customProps.get("propertyName");
```

??????????



|**????**|**??**|
|:-----|:-----|
| `Office.initialize`|? Exchange ????????????????????????|
| `customPropsCallback`|??? Exchange ???????????????????????|
| `updateProperty`|?????????????????? Exchange ????|
| `removeProperty`|????????????????? Exchange ????|
| `saveCallback`|?? `updateProperty` ? `removeProperty` ???? **saveAsync** ???|



```js
var _mailbox;
var _customProps;

// The initialize function is required for all add-ins.
Office.initialize = function (reason) {
    // Checks for the DOM to load using the jQuery ready function.
    $(document).ready(function () {
    // After the DOM is loaded, add-in-specific code can run.
    _mailbox = Office.context.mailbox;
    _mailbox.item.loadCustomPropertiesAsync(customPropsCallback);
    });
}

// Get the item's custom properties from the server and save for later use.
function customPropsCallback(asyncResult) {
    _customProps = asyncResult.value;
}

// Sets or updates the specified property, and then saves the change 
// to the server.
function updateProperty(name, value) {
    _customProps.set(name, value);
    _customProps.saveAsync(saveCallback);
}

// Removes the specified property, and then persists the removal 
// to the server.
function removeProperty(name) {
   _customProps.remove(name);
   _customProps.saveAsync(saveCallback);
}

// Callback for calls to saveAsync method. 
function saveCallback(asyncResult) {
    if (asyncResult.status == Office.AsyncResultStatus.Failed) {
        // Handle the failure.
    }
}
```


## <a name="see-also"></a>????

- [????? Office ? JavaScript API](understanding-the-javascript-api-for-office.md)
- [Outlook ???](https://docs.microsoft.com/en-us/outlook/add-ins/)
- [Excel-Add-in-JavaScript-PersistCustomSettings](https://github.com/OfficeDev/Excel-Add-in-JavaScript-PersistCustomSettings)
    
