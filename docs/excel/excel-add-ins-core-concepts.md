---
title: Excel JavaScript API ????
description: ''
ms.date: 12/04/2017
ms.openlocfilehash: 1582268a3bdac2b7fe63c4b0a48cf1a19f85bd31
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/23/2018
---
# <a name="excel-javascript-api-core-concepts"></a>Excel JavaScript API ????
 
???????? [Excel JavaScript API](https://dev.office.com/reference/add-ins/excel/excel-add-ins-reference-overview) ????? Excel 2016 ????? ?????????????????? API ??????????????????????????????????????????

## <a name="asynchronous-nature-of-excel-apis"></a>Excel API ?????

?? Web ? Excel ??????????????????????????? Office for Windows??? Office ???????? Office Online ?? HTML iFrame ???? ????????? Office.js API ?????????? Excel ?????????????? ???Office.js ?? **sync()** API ???? [promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)?? Excel ???????????????????????? ??????????????????????????????? **sync()** ????????????????????????????????? ??????????? **Excel.run()** ? **sync()** API ????
 
## <a name="excelrun"></a>Excel.run
 
**Excel.run** ???????????????? Excel ?????????? **Excel.run** ???????? Excel ????????????? ?? **Excel.run** ?????????????????????????
 
?????????? **Excel.run**? catch ??????? **Excel.run** ???????
 
```js
Excel.run(function (context) {
  // You can use the Excel JavaScript API here in the batch function
  // to execute actions on the Excel object model.
  console.log('Your code goes here.');
}).catch(function (error) {
  console.log('error: ' + error);
  if (error instanceof OfficeExtension.Error) {
    console.log('Debug info: ' + JSON.stringify(error.debugInfo));
  }
});
```

## <a name="request-context"></a>?????
 
Excel ????????????????????????????????? Excel ??????? **RequestContext** ?????????? Excel ???????????????????
 
## <a name="proxy-objects"></a>????
 
??????????? Excel JavaScript ???????? ????????????????????????????????????? ??????????? `context.sync()`???? **sync()** ???????????????? Excel ???? ???????Excel JavaScript API ?????????? ?????????????????????????? **sync()** ????????????????
 
????????????? JavaScript ?? **selectedRange** ??? Excel ??????????????????????? **SelectedRange** ???????????????????????????????????? Excel ??????????? **context.sync()**?
 
```js
const selectedRange = context.workbook.getSelectedRange();
selectedRange.format.fill.color = "#4472C4";
selectedRange.format.font.color = "white";
selectedRange.format.autofitColumns();
```
 
### <a name="sync"></a>sync()
 
????????? **sync()** ???? Excel ?????????????????? **Sync()** ?????????????????????????????????????????? **sync()** ?????????????? [promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)?? **sync()** ?????????
 
????????????????????? JavaScript ???? (**selectedRange**)?????????????? JavaScript Promises ???? **context.sync()** ??? Excel ????????????????
 
```js
Excel.run(function (context) {
  const selectedRange = context.workbook.getSelectedRange();
  selectedRange.load('address');
  return context.sync()
    .then(function () {
      console.log('The selected range is: ' + selectedRange.address);
  });
}).catch(function (error) {
  console.log('error: ' + error);
  if (error instanceof OfficeExtension.Error) {
    console.log('Debug info: ' + JSON.stringify(error.debugInfo));
  }
});
```
 
?????????? **selectedRange**????? **context.sync()** ???? **address** ???
 
?? **sync()** ????? promise ??????????? JavaScript ?????**??** promise? ????????????????? **sync()** ??? ???? **sync()** ??????????? [Excel JavaScript API ????](https://dev.office.com/reference/add-ins/excel/performance.md)?
 
### <a name="load"></a>load()
 
?????????????????????????????? Excel ????????????????? **context.sync()**? ??????????????????????????????? **address** ????????? **address** ???????????? ??????????????????????? **load()** ????????????? 

> [!NOTE]
> ??????????????????????? **load()** ??? ?????????????????? **load()** ???
 
?????????????????????????????????????????????????????????? **sync()** ???????????????????????? **load()** ???????
 
????????????????
 
```js
Excel.run(function (context) {
  const sheetName = 'Sheet1';
  const rangeAddress = 'A1:B2';
  const myRange = context.workbook.worksheets.getItem(sheetName).getRange(rangeAddress);
 
  myRange.load(['address', 'format/*', 'format/fill', 'entireRow' ]);
 
  return context.sync()
    .then(function () {
      console.log (myRange.address);              // ok
      console.log (myRange.format.wrapText);      // ok
      console.log (myRange.format.fill.color);    // ok
      //console.log (myRange.format.font.color);  // not ok as it was not loaded
  });
}).then(function () {
  console.log('done');
}).catch(function (error) {
  console.log('Error: ' + error);
  if (error instanceof OfficeExtension.Error) {
    console.log('Debug info: ' + JSON.stringify(error.debugInfo));
  }
});
```
 
?????????? `format/font` ??? **myRange.load()** ??????????? `format.font.color` ???

?????????????????? **load()** ?????????????????? [Excel JavaScript API????](performance.md)??? ?? **load()** ??????????? [Excel JavaScript API ????](excel-add-ins-advanced-concepts.md)?

## <a name="null-or-blank-property-values"></a>null ?????
 
### <a name="null-input-in-2-d-array"></a>?????? null ??
 
? Excel ?????????????????????????????????? ???????????????????????????????????????????????????????????????????? `null`?
 
????????????????????????????????????????????????????????????????????????? `null`? ???????????????????????????????????????????????????
 
```js
range.values = [['Eurasia', '29.96', '0.25', '15-Feb' ]];
range.numberFormat = [[null, null, null, 'm/d/yyyy;@']];
```
 
### <a name="null-input-for-a-property"></a>??? null ??
 
`null` ?????????????????????????????? **values** ??????? `null`?
 
```js
range.values = null;
```
 
???????????????? `null` ?? **color** ???????
 
```js
range.format.fill.color =  null;
```
 
### <a name="null-property-values-in-the-response"></a>???? null ???
 
???????????????? `size` ? `color` ????????????? `null` ?? ???????????????? `format.font.color` ???
 
* ??????????????????????? `range.format.font.color` ???????
* ???????????????? `range.format.font.color` ? `null`?
 
### <a name="blank-input-for-a-property"></a>???????
 
?????????????????????? `''`?????????????????????
 
* ?????? `values` ???????????????????
 
* ??? `numberFormat` ?????????????????? `General`?
 
* ??? `formula` ??? `formulaLocale` ??????????????????
 
### <a name="blank-property-values-in-the-response"></a>????????
 
??????????????????????????? `''`????????????????? ????????????????????????????????? ????????????????????????
 
```js
range.values = [['', 'some', 'data', 'in', 'other', 'cells', '']];
```
 
```js
range.formula = [['', '', '=Rand()']];
```
 
## <a name="read-or-write-to-an-unbounded-range"></a>?????????
 
### <a name="read-an-unbounded-range"></a>??????
 
???????????????????????????????????????
 
* ??????????????????<ul><li>`C:C`</li><li>`A:F`</li></ul>
* ???????????<ul><li>`2:2`</li><li>`1:4`</li></ul>
 
API ????????????????`getRange('C:C')`????????????????? `values`?`text`?`numberFormat` ? `formula`?? `null` ?? ???????? `address` ? `cellCount`?????????????
 
### <a name="write-to-an-unbounded-range"></a>????????
 
??????????????????????????????? `values`?`numberFormat` ? `formula`? ???????????????????????? `values`? ????????????????????API ????????
 
```js
const range = context.workbook.worksheets.getActiveWorksheet().getRange('A:B');
range.values = 'Due Date';
```
 
## <a name="read-or-write-to-a-large-range"></a>?????????
 
????????????????????/??????????????? API ??? API ???????????????????????????????????????????????????????????????? API ??? ????????????????????????????????????????????????????????
 
## <a name="update-all-cells-in-a-range"></a>???????????
 
?????????????????????????????????????????????????????????????????? **range** ???????????????????
 
??????????? 20 ????????????????????? **3/11/2015** ????????????
 
```js
Excel.run(function (context) {
  const sheetName = 'Sheet1';
  const rangeAddress = 'A1:A20';
  const worksheet = context.workbook.worksheets.getItem(sheetName);
 
  const range = worksheet.getRange(rangeAddress);
  range.numberFormat = 'm/d/yyyy';
  range.values = '3/11/2015';
  range.load('text');
 
  return context.sync()
    .then(function () {
      console.log(range.text);
  });
}).catch(function (error) {
  console.log('Error: ' + error);
  if (error instanceof OfficeExtension.Error) {
    console.log('Debug info: ' + JSON.stringify(error.debugInfo));
  }
});
```
 
## <a name="error-messages"></a>????
 
?? API ????API ??????????? **error** ??? ????? API ??????????
 
|error.code | error.message |
|:----------|:--------------|
|InvalidArgument |??????????????|
|InvalidRequest  |????????|
|InvalidReference|????????????|
|InvalidBinding  |??????????????????|
|InvalidSelection|??????????????|
|Unauthenticated |???????????????|
|????? |???????????|
|ItemNotFound |??????????|
|ActivityLimitReached|????????|
|GeneralException|????????????|
|NotImplemented  |??????????|
|ServiceNotAvailable|??????|
|??              |????????????|
|ItemAlreadyExists|??????????|
|UnsupportedOperation|???????????|
|RequestAborted|??????????|
|ApiNotAvailable|??? API ????|
|InsertDeleteConflict|???????????????|
|InvalidOperation|????????????|
 
## <a name="see-also"></a>????
 
* [???? Excel ???](excel-add-ins-get-started-overview.md)
* [Excel ????????](http://dev.office.com/code-samples#?filters=excel,office%20add-ins)
* [Excel JavaScript API????](https://dev.office.com/reference/add-ins/excel/performance.md)
* [Excel JavaScript API ??](https://dev.office.com/reference/add-ins/excel/excel-add-ins-reference-overview)
